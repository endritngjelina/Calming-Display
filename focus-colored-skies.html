<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glacial Ice Cave - Calming Experience</title>
    <style>
        :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  /* RGB versions for opacity control */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  /* Background color tokens (Light Mode) */
  --color-bg-1: rgba(59, 130, 246, 0.08); /* Light blue */
  --color-bg-2: rgba(245, 158, 11, 0.08); /* Light yellow */
  --color-bg-3: rgba(34, 197, 94, 0.08); /* Light green */
  --color-bg-4: rgba(239, 68, 68, 0.08); /* Light red */
  --color-bg-5: rgba(147, 51, 234, 0.08); /* Light purple */
  --color-bg-6: rgba(249, 115, 22, 0.08); /* Light orange */
  --color-bg-7: rgba(236, 72, 153, 0.08); /* Light pink */
  --color-bg-8: rgba(6, 182, 212, 0.08); /* Light cyan */

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  /* Common style patterns */
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;
  --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

  /* RGB versions for opacity control */
  --color-success-rgb: 33, 128, 141;
  --color-error-rgb: 192, 21, 47;
  --color-warning-rgb: 168, 75, 47;
  --color-info-rgb: 98, 108, 113;

  /* Typography */
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo,
    Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  /* Spacing */
  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  /* Border Radius */
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
    0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04),
    0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15),
    inset 0 -1px 0 rgba(0, 0, 0, 0.03);

  /* Animation */
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);

  /* Layout */
  --container-sm: 640px;
  --container-md: 768px;
  --container-lg: 1024px;
  --container-xl: 1280px;
}

/* Dark mode colors */
@media (prefers-color-scheme: dark) {
  :root {
    /* RGB versions for opacity control (Dark Mode) */
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;

    /* Background color tokens (Dark Mode) */
    --color-bg-1: rgba(29, 78, 216, 0.15); /* Dark blue */
    --color-bg-2: rgba(180, 83, 9, 0.15); /* Dark yellow */
    --color-bg-3: rgba(21, 128, 61, 0.15); /* Dark green */
    --color-bg-4: rgba(185, 28, 28, 0.15); /* Dark red */
    --color-bg-5: rgba(107, 33, 168, 0.15); /* Dark purple */
    --color-bg-6: rgba(194, 65, 12, 0.15); /* Dark orange */
    --color-bg-7: rgba(190, 24, 93, 0.15); /* Dark pink */
    --color-bg-8: rgba(8, 145, 178, 0.15); /* Dark cyan */

    /* Semantic Color Tokens (Dark Mode) */
    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
      inset 0 -1px 0 rgba(0, 0, 0, 0.15);
    --button-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
    --color-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
    --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);

    /* Common style patterns - updated for dark mode */
    --focus-ring: 0 0 0 3px var(--color-focus-ring);
    --focus-outline: 2px solid var(--color-primary);
    --status-bg-opacity: 0.15;
    --status-border-opacity: 0.25;
    --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

    /* RGB versions for dark mode */
    --color-success-rgb: var(--color-teal-300-rgb);
    --color-error-rgb: var(--color-red-400-rgb);
    --color-warning-rgb: var(--color-orange-400-rgb);
    --color-info-rgb: var(--color-gray-300-rgb);
  }
}

/* Data attribute for manual theme switching */
[data-color-scheme="dark"] {
  /* RGB versions for opacity control (dark mode) */
  --color-gray-400-rgb: 119, 124, 124;
  --color-teal-300-rgb: 50, 184, 198;
  --color-gray-300-rgb: 167, 169, 169;
  --color-gray-200-rgb: 245, 245, 245;

  /* Colorful background palette - Dark Mode */
  --color-bg-1: rgba(29, 78, 216, 0.15); /* Dark blue */
  --color-bg-2: rgba(180, 83, 9, 0.15); /* Dark yellow */
  --color-bg-3: rgba(21, 128, 61, 0.15); /* Dark green */
  --color-bg-4: rgba(185, 28, 28, 0.15); /* Dark red */
  --color-bg-5: rgba(107, 33, 168, 0.15); /* Dark purple */
  --color-bg-6: rgba(194, 65, 12, 0.15); /* Dark orange */
  --color-bg-7: rgba(190, 24, 93, 0.15); /* Dark pink */
  --color-bg-8: rgba(8, 145, 178, 0.15); /* Dark cyan */

  /* Semantic Color Tokens (Dark Mode) */
  --color-background: var(--color-charcoal-700);
  --color-surface: var(--color-charcoal-800);
  --color-text: var(--color-gray-200);
  --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
  --color-primary: var(--color-teal-300);
  --color-primary-hover: var(--color-teal-400);
  --color-primary-active: var(--color-teal-800);
  --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
  --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
  --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
  --color-border: rgba(var(--color-gray-400-rgb), 0.3);
  --color-error: var(--color-red-400);
  --color-success: var(--color-teal-300);
  --color-warning: var(--color-orange-400);
  --color-info: var(--color-gray-300);
  --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
  --color-btn-primary-text: var(--color-slate-900);
  --color-card-border: rgba(var(--color-gray-400-rgb), 0.15);
  --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
    inset 0 -1px 0 rgba(0, 0, 0, 0.15);
  --color-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
  --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);

  /* Common style patterns - updated for dark mode */
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;
  --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

  /* RGB versions for dark mode */
  --color-success-rgb: var(--color-teal-300-rgb);
  --color-error-rgb: var(--color-red-400-rgb);
  --color-warning-rgb: var(--color-orange-400-rgb);
  --color-info-rgb: var(--color-gray-300-rgb);
}

[data-color-scheme="light"] {
  /* RGB versions for opacity control (light mode) */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);

  /* RGB versions for light mode */
  --color-success-rgb: var(--color-teal-500-rgb);
  --color-error-rgb: var(--color-red-500-rgb);
  --color-warning-rgb: var(--color-orange-500-rgb);
  --color-info-rgb: var(--color-slate-500-rgb);
}

/* Base styles */
html {
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
}

*,
*::before,
*::after {
  box-sizing: inherit;
}

/* Typography */
h1,
h2,
h3,
h4,
h5,
h6 {
  margin: 0;
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-tight);
  color: var(--color-text);
  letter-spacing: var(--letter-spacing-tight);
}

h1 {
  font-size: var(--font-size-4xl);
}
h2 {
  font-size: var(--font-size-3xl);
}
h3 {
  font-size: var(--font-size-2xl);
}
h4 {
  font-size: var(--font-size-xl);
}
h5 {
  font-size: var(--font-size-lg);
}
h6 {
  font-size: var(--font-size-md);
}

p {
  margin: 0 0 var(--space-16) 0;
}

a {
  color: var(--color-primary);
  text-decoration: none;
  transition: color var(--duration-fast) var(--ease-standard);
}

a:hover {
  color: var(--color-primary-hover);
}

code,
pre {
  font-family: var(--font-family-mono);
  font-size: calc(var(--font-size-base) * 0.95);
  background-color: var(--color-secondary);
  border-radius: var(--radius-sm);
}

code {
  padding: var(--space-1) var(--space-4);
}

pre {
  padding: var(--space-16);
  margin: var(--space-16) 0;
  overflow: auto;
  border: 1px solid var(--color-border);
}

pre code {
  background: none;
  padding: 0;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-8) var(--space-16);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: 500;
  line-height: 1.5;
  cursor: pointer;
  transition: all var(--duration-normal) var(--ease-standard);
  border: none;
  text-decoration: none;
  position: relative;
}

.btn:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
}

.btn--primary {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.btn--primary:hover {
  background: var(--color-primary-hover);
}

.btn--primary:active {
  background: var(--color-primary-active);
}

.btn--secondary {
  background: var(--color-secondary);
  color: var(--color-text);
}

.btn--secondary:hover {
  background: var(--color-secondary-hover);
}

.btn--secondary:active {
  background: var(--color-secondary-active);
}

.btn--outline {
  background: transparent;
  border: 1px solid var(--color-border);
  color: var(--color-text);
}

.btn--outline:hover {
  background: var(--color-secondary);
}

.btn--sm {
  padding: var(--space-4) var(--space-12);
  font-size: var(--font-size-sm);
  border-radius: var(--radius-sm);
}

.btn--lg {
  padding: var(--space-10) var(--space-20);
  font-size: var(--font-size-lg);
  border-radius: var(--radius-md);
}

.btn--full-width {
  width: 100%;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Form elements */
.form-control {
  display: block;
  width: 100%;
  padding: var(--space-8) var(--space-12);
  font-size: var(--font-size-md);
  line-height: 1.5;
  color: var(--color-text);
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  transition: border-color var(--duration-fast) var(--ease-standard),
    box-shadow var(--duration-fast) var(--ease-standard);
}

textarea.form-control {
  font-family: var(--font-family-base);
  font-size: var(--font-size-base);
}

select.form-control {
  padding: var(--space-8) var(--space-12);
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background-image: var(--select-caret-light);
  background-repeat: no-repeat;
  background-position: right var(--space-12) center;
  background-size: 16px;
  padding-right: var(--space-32);
}

/* Add a dark mode specific caret */
@media (prefers-color-scheme: dark) {
  select.form-control {
    background-image: var(--select-caret-dark);
  }
}

/* Also handle data-color-scheme */
[data-color-scheme="dark"] select.form-control {
  background-image: var(--select-caret-dark);
}

[data-color-scheme="light"] select.form-control {
  background-image: var(--select-caret-light);
}

.form-control:focus {
  border-color: var(--color-primary);
  outline: var(--focus-outline);
}

.form-label {
  display: block;
  margin-bottom: var(--space-8);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
}

.form-group {
  margin-bottom: var(--space-16);
}

/* Card component */
.card {
  background-color: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  transition: box-shadow var(--duration-normal) var(--ease-standard);
}

.card:hover {
  box-shadow: var(--shadow-md);
}

.card__body {
  padding: var(--space-16);
}

.card__header,
.card__footer {
  padding: var(--space-16);
  border-bottom: 1px solid var(--color-card-border-inner);
}

/* Status indicators - simplified with CSS variables */
.status {
  display: inline-flex;
  align-items: center;
  padding: var(--space-6) var(--space-12);
  border-radius: var(--radius-full);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
}

.status--success {
  background-color: rgba(
    var(--color-success-rgb, 33, 128, 141),
    var(--status-bg-opacity)
  );
  color: var(--color-success);
  border: 1px solid
    rgba(var(--color-success-rgb, 33, 128, 141), var(--status-border-opacity));
}

.status--error {
  background-color: rgba(
    var(--color-error-rgb, 192, 21, 47),
    var(--status-bg-opacity)
  );
  color: var(--color-error);
  border: 1px solid
    rgba(var(--color-error-rgb, 192, 21, 47), var(--status-border-opacity));
}

.status--warning {
  background-color: rgba(
    var(--color-warning-rgb, 168, 75, 47),
    var(--status-bg-opacity)
  );
  color: var(--color-warning);
  border: 1px solid
    rgba(var(--color-warning-rgb, 168, 75, 47), var(--status-border-opacity));
}

.status--info {
  background-color: rgba(
    var(--color-info-rgb, 98, 108, 113),
    var(--status-bg-opacity)
  );
  color: var(--color-info);
  border: 1px solid
    rgba(var(--color-info-rgb, 98, 108, 113), var(--status-border-opacity));
}

/* Container layout */
.container {
  width: 100%;
  margin-right: auto;
  margin-left: auto;
  padding-right: var(--space-16);
  padding-left: var(--space-16);
}

@media (min-width: 640px) {
  .container {
    max-width: var(--container-sm);
  }
}
@media (min-width: 768px) {
  .container {
    max-width: var(--container-md);
  }
}
@media (min-width: 1024px) {
  .container {
    max-width: var(--container-lg);
  }
}
@media (min-width: 1280px) {
  .container {
    max-width: var(--container-xl);
  }
}

/* Utility classes */
.flex {
  display: flex;
}
.flex-col {
  flex-direction: column;
}
.items-center {
  align-items: center;
}
.justify-center {
  justify-content: center;
}
.justify-between {
  justify-content: space-between;
}
.gap-4 {
  gap: var(--space-4);
}
.gap-8 {
  gap: var(--space-8);
}
.gap-16 {
  gap: var(--space-16);
}

.m-0 {
  margin: 0;
}
.mt-8 {
  margin-top: var(--space-8);
}
.mb-8 {
  margin-bottom: var(--space-8);
}
.mx-8 {
  margin-left: var(--space-8);
  margin-right: var(--space-8);
}
.my-8 {
  margin-top: var(--space-8);
  margin-bottom: var(--space-8);
}

.p-0 {
  padding: 0;
}
.py-8 {
  padding-top: var(--space-8);
  padding-bottom: var(--space-8);
}
.px-8 {
  padding-left: var(--space-8);
  padding-right: var(--space-8);
}
.py-16 {
  padding-top: var(--space-16);
  padding-bottom: var(--space-16);
}
.px-16 {
  padding-left: var(--space-16);
  padding-right: var(--space-16);
}

.block {
  display: block;
}
.hidden {
  display: none;
}

/* Accessibility */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

:focus-visible {
  outline: var(--focus-outline);
  outline-offset: 2px;
}

/* Dark mode specifics */
[data-color-scheme="dark"] .btn--outline {
  border: 1px solid var(--color-border-secondary);
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2')
    format('woff2');
}

/* END PERPLEXITY DESIGN SYSTEM */
:root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;

  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);

  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-lg: 16px;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;

  --space-8: 8px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;

  --radius-base: 8px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2') format('woff2');
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: var(--font-family-base);
  -webkit-font-smoothing: antialiased;
}

#app {
  position: relative;
  width: 100%;
  height: 100%;
  background: #0a1929;
}

/* Canvas */
#mainCanvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: block;
}

/* Light Shafts */
.light-shafts-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
  opacity: 0.7;
  transition: opacity 0.5s ease;
}

.light-shafts-container.hidden {
  opacity: 0;
}

.light-shaft {
  position: absolute;
  top: -20%;
  width: 150px;
  height: 120%;
  background: linear-gradient(to bottom, 
    rgba(255, 255, 255, 0.15) 0%,
    rgba(255, 255, 255, 0.08) 30%,
    rgba(255, 255, 255, 0.02) 60%,
    rgba(255, 255, 255, 0) 100%);
  filter: blur(20px);
  transform-origin: top center;
}

.light-shaft.shaft-1 {
  left: 20%;
  animation: lightShaftPulse 12s ease-in-out infinite, lightShaftSway 18s ease-in-out infinite;
}

.light-shaft.shaft-2 {
  left: 50%;
  width: 200px;
  animation: lightShaftPulse 15s ease-in-out infinite 2s, lightShaftSway 20s ease-in-out infinite 1s;
}

.light-shaft.shaft-3 {
  left: 75%;
  width: 120px;
  animation: lightShaftPulse 10s ease-in-out infinite 4s, lightShaftSway 16s ease-in-out infinite 3s;
}

@keyframes lightShaftPulse {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 0.6; }
}

@keyframes lightShaftSway {
  0%, 100% { transform: translateX(0) rotate(0deg); }
  25% { transform: translateX(30px) rotate(2deg); }
  75% { transform: translateX(-30px) rotate(-2deg); }
}

/* Color Overlay */
.color-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 2;
  transition: background-color 1s ease;
  background-color: rgba(26, 77, 102, 0.1);
}

/* Controls Toggle Button */
.controls-toggle {
  position: fixed;
  top: var(--space-20);
  right: var(--space-20);
  z-index: 100;
  display: flex;
  align-items: center;
  gap: var(--space-8);
  padding: var(--space-12) var(--space-20);
  background: rgba(255, 255, 255, 0.95);
  color: var(--color-text);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: var(--radius-full);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  transition: all var(--duration-normal) var(--ease-standard);
}

.controls-toggle:hover {
  background: rgba(255, 255, 255, 1);
  transform: translateY(-2px);
  box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
}

.controls-toggle svg {
  width: 20px;
  height: 20px;
}

/* Control Panel */
.control-panel {
  position: fixed;
  top: 0;
  right: -400px;
  width: 380px;
  height: 100%;
  background: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(20px);
  box-shadow: -4px 0 30px rgba(0, 0, 0, 0.2);
  z-index: 101;
  transition: right 0.4s var(--ease-standard);
  display: flex;
  flex-direction: column;
}

.control-panel.open {
  right: 0;
}

.control-panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-24) var(--space-24) var(--space-16);
  border-bottom: 1px solid rgba(0, 0, 0, 0.08);
}

.control-panel-header h2 {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}

.close-btn {
  background: none;
  border: none;
  cursor: pointer;
  padding: var(--space-8);
  color: var(--color-text-secondary);
  transition: color var(--duration-normal);
}

.close-btn:hover {
  color: var(--color-text);
}

.control-panel-content {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-24);
}

/* Control Groups */
.control-group {
  margin-bottom: var(--space-24);
}

.control-label {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  margin-bottom: var(--space-12);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.control-value {
  font-weight: var(--font-weight-semibold);
  color: var(--color-primary);
}

/* Scenery Buttons */
.scenery-buttons {
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
}

.scenery-btn {
  padding: var(--space-12) var(--space-16);
  background: rgba(0, 0, 0, 0.03);
  border: 1px solid rgba(0, 0, 0, 0.08);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  cursor: pointer;
  transition: all var(--duration-normal) var(--ease-standard);
  text-align: left;
}

.scenery-btn:hover {
  background: rgba(0, 0, 0, 0.06);
  border-color: var(--color-primary);
}

.scenery-btn.active {
  background: var(--color-primary);
  border-color: var(--color-primary);
  color: white;
}

/* Sliders */
.slider {
  width: 100%;
  height: 6px;
  background: rgba(0, 0, 0, 0.08);
  border-radius: var(--radius-full);
  outline: none;
  -webkit-appearance: none;
  appearance: none;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  background: var(--color-primary);
  border-radius: 50%;
  cursor: pointer;
  transition: all var(--duration-normal);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.slider::-webkit-slider-thumb:hover {
  transform: scale(1.2);
  box-shadow: 0 3px 12px rgba(0, 0, 0, 0.25);
}

.slider::-moz-range-thumb {
  width: 18px;
  height: 18px;
  background: var(--color-primary);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: all var(--duration-normal);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.slider::-moz-range-thumb:hover {
  transform: scale(1.2);
  box-shadow: 0 3px 12px rgba(0, 0, 0, 0.25);
}

/* Color Tone Buttons */
.color-tone-buttons {
  display: flex;
  gap: var(--space-12);
}

.tone-btn {
  width: 50px;
  height: 50px;
  border: 3px solid transparent;
  border-radius: var(--radius-base);
  cursor: pointer;
  transition: all var(--duration-normal) var(--ease-standard);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.tone-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.tone-btn.active {
  border-color: white;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3), 0 0 0 2px var(--color-primary);
}

/* Toggle Switches */
.toggle-group {
  display: flex;
  flex-direction: column;
  gap: var(--space-12);
}

.toggle-switch {
  display: flex;
  align-items: center;
  gap: var(--space-12);
  cursor: pointer;
}

.toggle-switch input[type="checkbox"] {
  display: none;
}

.toggle-slider {
  position: relative;
  width: 44px;
  height: 24px;
  background: rgba(0, 0, 0, 0.15);
  border-radius: var(--radius-full);
  transition: background var(--duration-normal);
}

.toggle-slider::after {
  content: '';
  position: absolute;
  top: 3px;
  left: 3px;
  width: 18px;
  height: 18px;
  background: white;
  border-radius: 50%;
  transition: transform var(--duration-normal) var(--ease-standard);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.toggle-switch input[type="checkbox"]:checked + .toggle-slider {
  background: var(--color-primary);
}

.toggle-switch input[type="checkbox"]:checked + .toggle-slider::after {
  transform: translateX(20px);
}

.toggle-label {
  font-size: var(--font-size-base);
  color: var(--color-text);
  font-weight: var(--font-weight-medium);
}

/* Buttons */
.btn {
  padding: var(--space-12) var(--space-20);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all var(--duration-normal) var(--ease-standard);
  border: none;
}

.btn--secondary {
  background: rgba(0, 0, 0, 0.06);
  color: var(--color-text);
  border: 1px solid rgba(0, 0, 0, 0.12);
}

.btn--secondary:hover {
  background: rgba(0, 0, 0, 0.1);
  border-color: rgba(0, 0, 0, 0.2);
}

.btn--full-width {
  width: 100%;
}

/* Info Hint */
.info-hint {
  position: fixed;
  bottom: var(--space-24);
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.95);
  padding: var(--space-12) var(--space-24);
  border-radius: var(--radius-full);
  font-size: var(--font-size-sm);
  color: var(--color-text);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(10px);
  z-index: 50;
  animation: hintFadeIn 0.5s ease, hintFadeOut 0.5s ease 4.5s forwards;
}

@keyframes hintFadeIn {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

@keyframes hintFadeOut {
  to {
    opacity: 0;
    transform: translateX(-50%) translateY(20px);
  }
}

/* Responsive Design */
@media (max-width: 768px) {
  .control-panel {
    width: 100%;
    right: -100%;
  }
  
  .controls-toggle {
    top: var(--space-16);
    right: var(--space-16);
    padding: var(--space-8) var(--space-16);
  }
  
  .info-hint {
    left: var(--space-16);
    right: var(--space-16);
    transform: none;
    text-align: center;
  }
  
  @keyframes hintFadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes hintFadeOut {
    to {
      opacity: 0;
      transform: translateY(20px);
    }
  }
}
    </style>
</head>
<body>
    <div id="app">
        <!-- Main Canvas -->
        <canvas id="mainCanvas"></canvas>
        
        <!-- Light Shafts Layer -->
        <div id="lightShafts" class="light-shafts-container">
            <div class="light-shaft shaft-1"></div>
            <div class="light-shaft shaft-2"></div>
            <div class="light-shaft shaft-3"></div>
        </div>
        
        <!-- Color Tone Overlay -->
        <div id="colorOverlay" class="color-overlay"></div>
        
        <!-- Controls Toggle Button -->
        <button id="controlsToggle" class="controls-toggle" aria-label="Toggle Controls">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3"></path>
            </svg>
            <span>Controls</span>
        </button>
        
        <!-- Control Panel -->
        <div id="controlPanel" class="control-panel">
            <div class="control-panel-header">
                <h2>Scene Controls</h2>
                <button id="closePanel" class="close-btn" aria-label="Close Panel">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="control-panel-content">
                <!-- Scenery Selection -->
                <div class="control-group">
                    <label class="control-label">Scenery</label>
                    <div class="scenery-buttons">
                        <button class="scenery-btn active" data-scenery="glacial_ice_cave">Glacial Ice Cave</button>
                        <button class="scenery-btn" data-scenery="aurora_borealis">Aurora Borealis</button>
                        <button class="scenery-btn" data-scenery="frozen_waterfall">Frozen Waterfall</button>
                        <button class="scenery-btn" data-scenery="snow_storm">Snow Storm</button>
                        <button class="scenery-btn" data-scenery="deep_ocean">Deep Ocean Blue</button>
                    </div>
                </div>
                
                <!-- Particle Intensity -->
                <div class="control-group">
                    <label class="control-label" for="intensitySlider">
                        Particle Intensity
                        <span class="control-value" id="intensityValue">60</span>
                    </label>
                    <input type="range" id="intensitySlider" min="10" max="100" value="60" class="slider">
                </div>
                
                <!-- Animation Speed -->
                <div class="control-group">
                    <label class="control-label" for="speedSlider">
                        Animation Speed
                        <span class="control-value" id="speedValue">1.0x</span>
                    </label>
                    <input type="range" id="speedSlider" min="0.5" max="2.0" step="0.1" value="1.0" class="slider">
                </div>
                
                <!-- Light Shaft Intensity -->
                <div class="control-group">
                    <label class="control-label" for="lightSlider">
                        Light Shaft Intensity
                        <span class="control-value" id="lightValue">70</span>
                    </label>
                    <input type="range" id="lightSlider" min="0" max="100" value="70" class="slider">
                </div>
                
                <!-- Color Tone -->
                <div class="control-group">
                    <label class="control-label">Color Tone</label>
                    <div class="color-tone-buttons">
                        <button class="tone-btn active" data-tone="cool_blue" style="background: linear-gradient(135deg, #1a4d66, #4db8d9);" aria-label="Cool Blue"></button>
                        <button class="tone-btn" data-tone="warm_amber" style="background: linear-gradient(135deg, #cc5500, #ff9955);" aria-label="Warm Amber"></button>
                        <button class="tone-btn" data-tone="purple_twilight" style="background: linear-gradient(135deg, #663399, #9966cc);" aria-label="Purple Twilight"></button>
                        <button class="tone-btn" data-tone="mint_green" style="background: linear-gradient(135deg, #009966, #00cc88);" aria-label="Mint Green"></button>
                        <button class="tone-btn" data-tone="soft_pink" style="background: linear-gradient(135deg, #cc6699, #ff99cc);" aria-label="Soft Pink"></button>
                    </div>
                </div>
                
                <!-- Toggle Options -->
                <div class="control-group">
                    <label class="control-label">Effects</label>
                    <div class="toggle-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="sparklesToggle" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Sparkles</span>
                        </label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="lightShaftsToggle" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Light Shafts</span>
                        </label>
                    </div>
                </div>
                
                <!-- Reset Button -->
                <div class="control-group">
                    <button id="resetBtn" class="btn btn--secondary btn--full-width">Reset to Default</button>
                </div>
            </div>
        </div>
        
        <!-- Info Hint -->
        <div id="infoHint" class="info-hint">
            <p>Click "Controls" to customize your experience</p>
        </div>
    </div>
    
    <script>
        // Scenery Data
const SCENERIES = {
  glacial_ice_cave: {
    name: 'Glacial Ice Cave',
    colors: { primary: '#1a4d66', secondary: '#2d7a99', accent: '#4db8d9' },
    defaultIntensity: 60,
    particleType: 'ice'
  },
  aurora_borealis: {
    name: 'Aurora Borealis',
    colors: { primary: '#0a0f2c', secondary: '#2a0d5c', accent: '#00ff88' },
    defaultIntensity: 40,
    particleType: 'aurora'
  },
  frozen_waterfall: {
    name: 'Frozen Waterfall',
    colors: { primary: '#1a3a4d', secondary: '#2d5a7a', accent: '#b3e5ff' },
    defaultIntensity: 70,
    particleType: 'waterfall'
  },
  snow_storm: {
    name: 'Snow Storm',
    colors: { primary: '#1a1a2e', secondary: '#2d3561', accent: '#ffffff' },
    defaultIntensity: 85,
    particleType: 'snow'
  },
  deep_ocean: {
    name: 'Deep Ocean Blue',
    colors: { primary: '#001a33', secondary: '#003d66', accent: '#00ffcc' },
    defaultIntensity: 50,
    particleType: 'bioluminescent'
  }
};

const COLOR_TONES = {
  cool_blue: 'rgba(26, 77, 102, 0.1)',
  warm_amber: 'rgba(204, 85, 0, 0.08)',
  purple_twilight: 'rgba(102, 51, 153, 0.1)',
  mint_green: 'rgba(0, 153, 102, 0.08)',
  soft_pink: 'rgba(204, 102, 153, 0.08)'
};

// Application State
const state = {
  scenery: 'glacial_ice_cave',
  intensity: 60,
  animationSpeed: 1.0,
  lightIntensity: 70,
  colorTone: 'cool_blue',
  sparklesEnabled: true,
  lightShaftsEnabled: true
};

// Canvas and Particle System
let canvas, ctx, particles = [];
let animationId;
let time = 0;

// Particle Class
class Particle {
  constructor(sceneryType) {
    this.reset(sceneryType);
  }
  
  reset(sceneryType) {
    this.x = Math.random() * canvas.width;
    this.y = Math.random() * canvas.height - canvas.height;
    this.size = Math.random() * 3 + 1;
    this.speedX = (Math.random() - 0.5) * 0.5;
    this.sceneryType = sceneryType;
    
    const scenery = SCENERIES[state.scenery];
    
    switch(sceneryType) {
      case 'ice':
        this.speedY = Math.random() * 0.3 + 0.2;
        this.opacity = Math.random() * 0.6 + 0.4;
        break;
      case 'aurora':
        this.speedY = Math.random() * 0.1 + 0.05;
        this.opacity = Math.random() * 0.4 + 0.3;
        this.waveOffset = Math.random() * Math.PI * 2;
        break;
      case 'waterfall':
        this.speedY = Math.random() * 0.8 + 0.5;
        this.opacity = Math.random() * 0.7 + 0.3;
        break;
      case 'snow':
        this.speedY = Math.random() * 0.6 + 0.4;
        this.speedX = (Math.random() - 0.5) * 1.5;
        this.opacity = Math.random() * 0.8 + 0.2;
        break;
      case 'bioluminescent':
        this.speedY = Math.random() * 0.2 + 0.1;
        this.opacity = Math.random() * 0.5 + 0.5;
        this.pulseOffset = Math.random() * Math.PI * 2;
        break;
    }
    
    this.color = this.getColor();
  }
  
  getColor() {
    const scenery = SCENERIES[state.scenery];
    const colors = [scenery.colors.accent, scenery.colors.secondary];
    return colors[Math.floor(Math.random() * colors.length)];
  }
  
  update(deltaTime) {
    const speed = state.animationSpeed;
    
    switch(this.sceneryType) {
      case 'aurora':
        this.x += Math.sin(time * 0.001 + this.waveOffset) * 0.5 * speed;
        this.y += this.speedY * speed;
        this.opacity = 0.3 + Math.sin(time * 0.002 + this.waveOffset) * 0.2;
        break;
      case 'bioluminescent':
        this.y += this.speedY * speed;
        this.opacity = 0.5 + Math.sin(time * 0.003 + this.pulseOffset) * 0.3;
        break;
      default:
        this.x += this.speedX * speed;
        this.y += this.speedY * speed;
    }
    
    // Wrap around screen
    if (this.y > canvas.height + 10) {
      this.y = -10;
      this.x = Math.random() * canvas.width;
    }
    if (this.x > canvas.width + 10) this.x = -10;
    if (this.x < -10) this.x = canvas.width + 10;
  }
  
  draw() {
    if (!state.sparklesEnabled && this.sceneryType !== 'snow') return;
    
    ctx.save();
    ctx.globalAlpha = this.opacity;
    
    // Draw particle with glow
    const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size * 2);
    gradient.addColorStop(0, this.color);
    gradient.addColorStop(1, 'transparent');
    
    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size * 2, 0, Math.PI * 2);
    ctx.fill();
    
    // Core particle
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size * 0.5, 0, Math.PI * 2);
    ctx.fill();
    
    ctx.restore();
  }
}

// Initialize Canvas
function initCanvas() {
  canvas = document.getElementById('mainCanvas');
  ctx = canvas.getContext('2d');
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);
}

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  updateParticleCount();
}

// Update Particle Count
function updateParticleCount() {
  const targetCount = Math.floor((state.intensity / 100) * 200);
  const currentType = SCENERIES[state.scenery].particleType;
  
  while (particles.length < targetCount) {
    particles.push(new Particle(currentType));
  }
  
  while (particles.length > targetCount) {
    particles.pop();
  }
}

// Draw Background Gradient
function drawBackground() {
  const scenery = SCENERIES[state.scenery];
  
  // Create gradient based on scenery
  const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
  
  switch(state.scenery) {
    case 'glacial_ice_cave':
      gradient.addColorStop(0, scenery.colors.primary);
      gradient.addColorStop(0.5, scenery.colors.secondary);
      gradient.addColorStop(1, '#0a1f2e');
      break;
    case 'aurora_borealis':
      gradient.addColorStop(0, scenery.colors.primary);
      gradient.addColorStop(0.4, scenery.colors.secondary);
      gradient.addColorStop(0.7, '#1a0f3c');
      gradient.addColorStop(1, '#000511');
      // Add aurora waves
      drawAuroraWaves();
      break;
    case 'frozen_waterfall':
      gradient.addColorStop(0, scenery.colors.primary);
      gradient.addColorStop(0.6, scenery.colors.secondary);
      gradient.addColorStop(1, '#0d1f2e');
      break;
    case 'snow_storm':
      gradient.addColorStop(0, scenery.colors.primary);
      gradient.addColorStop(0.5, scenery.colors.secondary);
      gradient.addColorStop(1, '#0f1522');
      break;
    case 'deep_ocean':
      gradient.addColorStop(0, scenery.colors.primary);
      gradient.addColorStop(0.5, scenery.colors.secondary);
      gradient.addColorStop(1, '#000a14');
      break;
  }
  
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

// Draw Aurora Waves (special effect for Aurora Borealis)
function drawAuroraWaves() {
  ctx.save();
  
  for (let i = 0; i < 3; i++) {
    const gradient = ctx.createLinearGradient(0, canvas.height * 0.2, 0, canvas.height * 0.6);
    const offset = i * Math.PI / 1.5;
    const opacity = 0.15 + Math.sin(time * 0.001 + offset) * 0.1;
    
    if (i === 0) {
      gradient.addColorStop(0, `rgba(0, 255, 136, 0)`);
      gradient.addColorStop(0.5, `rgba(0, 255, 136, ${opacity})`);
      gradient.addColorStop(1, `rgba(0, 255, 136, 0)`);
    } else if (i === 1) {
      gradient.addColorStop(0, `rgba(138, 43, 226, 0)`);
      gradient.addColorStop(0.5, `rgba(138, 43, 226, ${opacity})`);
      gradient.addColorStop(1, `rgba(138, 43, 226, 0)`);
    } else {
      gradient.addColorStop(0, `rgba(0, 191, 255, 0)`);
      gradient.addColorStop(0.5, `rgba(0, 191, 255, ${opacity})`);
      gradient.addColorStop(1, `rgba(0, 191, 255, 0)`);
    }
    
    ctx.fillStyle = gradient;
    ctx.beginPath();
    
    const yOffset = canvas.height * 0.3 + i * 80;
    for (let x = 0; x <= canvas.width; x += 10) {
      const y = yOffset + Math.sin(x * 0.01 + time * 0.001 + offset) * 50;
      if (x === 0) {
        ctx.moveTo(x, y);
      } else {
        ctx.lineTo(x, y);
      }
    }
    
    ctx.lineTo(canvas.width, canvas.height);
    ctx.lineTo(0, canvas.height);
    ctx.closePath();
    ctx.fill();
  }
  
  ctx.restore();
}

// Animation Loop
function animate() {
  time += 16;
  
  // Clear and draw background
  drawBackground();
  
  // Update and draw particles
  particles.forEach(particle => {
    particle.update(16);
    particle.draw();
  });
  
  animationId = requestAnimationFrame(animate);
}

// Update Scenery
function updateScenery(sceneryId) {
  state.scenery = sceneryId;
  const scenery = SCENERIES[sceneryId];
  
  // Fade transition
  canvas.style.opacity = '0';
  setTimeout(() => {
    // Update particles
    particles.forEach(particle => {
      particle.reset(scenery.particleType);
    });
    canvas.style.opacity = '1';
  }, 300);
  
  canvas.style.transition = 'opacity 0.3s ease';
}

// Update Light Shafts
function updateLightShafts() {
  const container = document.getElementById('lightShafts');
  const intensity = state.lightIntensity / 100;
  
  if (state.lightShaftsEnabled) {
    container.classList.remove('hidden');
    container.style.opacity = intensity * 0.7;
  } else {
    container.classList.add('hidden');
  }
}

// Update Color Overlay
function updateColorOverlay() {
  const overlay = document.getElementById('colorOverlay');
  overlay.style.backgroundColor = COLOR_TONES[state.colorTone];
}

// UI Event Handlers
function initUI() {
  const controlsToggle = document.getElementById('controlsToggle');
  const controlPanel = document.getElementById('controlPanel');
  const closePanel = document.getElementById('closePanel');
  
  controlsToggle.addEventListener('click', () => {
    controlPanel.classList.add('open');
  });
  
  closePanel.addEventListener('click', () => {
    controlPanel.classList.remove('open');
  });
  
  // Scenery buttons
  document.querySelectorAll('.scenery-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      document.querySelectorAll('.scenery-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      updateScenery(btn.dataset.scenery);
    });
  });
  
  // Intensity slider
  const intensitySlider = document.getElementById('intensitySlider');
  const intensityValue = document.getElementById('intensityValue');
  intensitySlider.addEventListener('input', (e) => {
    state.intensity = parseInt(e.target.value);
    intensityValue.textContent = state.intensity;
    updateParticleCount();
  });
  
  // Speed slider
  const speedSlider = document.getElementById('speedSlider');
  const speedValue = document.getElementById('speedValue');
  speedSlider.addEventListener('input', (e) => {
    state.animationSpeed = parseFloat(e.target.value);
    speedValue.textContent = state.animationSpeed.toFixed(1) + 'x';
  });
  
  // Light slider
  const lightSlider = document.getElementById('lightSlider');
  const lightValue = document.getElementById('lightValue');
  lightSlider.addEventListener('input', (e) => {
    state.lightIntensity = parseInt(e.target.value);
    lightValue.textContent = state.lightIntensity;
    updateLightShafts();
  });
  
  // Color tone buttons
  document.querySelectorAll('.tone-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tone-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      state.colorTone = btn.dataset.tone;
      updateColorOverlay();
    });
  });
  
  // Toggle switches
  const sparklesToggle = document.getElementById('sparklesToggle');
  sparklesToggle.addEventListener('change', (e) => {
    state.sparklesEnabled = e.target.checked;
  });
  
  const lightShaftsToggle = document.getElementById('lightShaftsToggle');
  lightShaftsToggle.addEventListener('change', (e) => {
    state.lightShaftsEnabled = e.target.checked;
    updateLightShafts();
  });
  
  // Reset button
  const resetBtn = document.getElementById('resetBtn');
  resetBtn.addEventListener('click', () => {
    resetToDefaults();
  });
}

// Reset to Defaults
function resetToDefaults() {
  state.scenery = 'glacial_ice_cave';
  state.intensity = 60;
  state.animationSpeed = 1.0;
  state.lightIntensity = 70;
  state.colorTone = 'cool_blue';
  state.sparklesEnabled = true;
  state.lightShaftsEnabled = true;
  
  // Update UI
  document.getElementById('intensitySlider').value = 60;
  document.getElementById('intensityValue').textContent = '60';
  document.getElementById('speedSlider').value = 1.0;
  document.getElementById('speedValue').textContent = '1.0x';
  document.getElementById('lightSlider').value = 70;
  document.getElementById('lightValue').textContent = '70';
  document.getElementById('sparklesToggle').checked = true;
  document.getElementById('lightShaftsToggle').checked = true;
  
  document.querySelectorAll('.scenery-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.scenery === 'glacial_ice_cave');
  });
  
  document.querySelectorAll('.tone-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.tone === 'cool_blue');
  });
  
  updateScenery('glacial_ice_cave');
  updateParticleCount();
  updateLightShafts();
  updateColorOverlay();
}

// Initialize Application
function init() {
  initCanvas();
  initUI();
  updateLightShafts();
  updateColorOverlay();
  updateParticleCount();
  animate();
  
  // Hide info hint after 5 seconds
  setTimeout(() => {
    const hint = document.getElementById('infoHint');
    if (hint) hint.style.display = 'none';
  }, 5000);
}

// Start the application
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}
    </script>
</body>
</html>