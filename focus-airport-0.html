<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airport View - Calming Scenery</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-teal-800: rgba(41, 150, 161, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-orange-500: rgba(168, 75, 47, 1);
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-slate-500-rgb: 98, 108, 113;
            --color-red-500-rgb: 192, 21, 47;
            --color-red-400-rgb: 255, 84, 89;
            --color-orange-500-rgb: 168, 75, 47;
            --color-orange-400-rgb: 230, 129, 97;
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --color-success: var(--color-teal-500);
            --color-warning: var(--color-orange-500);
            --color-info: var(--color-slate-500);
            --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
            --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-size-xs: 11px;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-md: 14px;
            --font-size-lg: 16px;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 550;
            --font-weight-bold: 600;
            --space-4: 4px;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --radius-sm: 6px;
            --radius-base: 8px;
            --radius-md: 10px;
            --radius-lg: 12px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300-rgb: 50, 184, 198;
                --color-gray-300-rgb: 167, 169, 169;
                --color-gray-200-rgb: 245, 245, 245;
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-primary-active: var(--color-teal-800);
                --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
                --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
                --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-error: var(--color-red-400);
                --color-success: var(--color-teal-300);
                --color-warning: var(--color-orange-400);
                --color-info: var(--color-gray-300);
                --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
                --color-btn-primary-text: var(--color-slate-900);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
                --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-base);
            background-color: var(--color-background);
            color: var(--color-text);
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        #app {
            width: 100%;
            height: 100%;
            display: flex;
            position: relative;
        }

        #canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        #airportCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        #controls {
            width: 320px;
            background-color: var(--color-surface);
            border-left: 1px solid var(--color-border);
            padding: var(--space-20);
            overflow-y: auto;
            box-shadow: var(--shadow-md);
            transition: transform 0.3s ease;
        }

        #controls.hidden {
            transform: translateX(100%);
        }

        .control-group {
            margin-bottom: var(--space-24);
        }

        .control-label {
            display: block;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-8);
            color: var(--color-text);
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--color-secondary);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--color-primary);
            cursor: pointer;
            transition: background 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: var(--color-primary-hover);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--color-primary);
            cursor: pointer;
            border: none;
        }

        select {
            width: 100%;
            padding: var(--space-8) var(--space-12);
            font-size: var(--font-size-sm);
            background-color: var(--color-surface);
            color: var(--color-text);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            cursor: pointer;
            outline: none;
        }

        select:focus {
            border-color: var(--color-primary);
        }

        .button-group {
            display: flex;
            gap: var(--space-8);
            flex-wrap: wrap;
        }

        button {
            padding: var(--space-8) var(--space-12);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            background-color: var(--color-secondary);
            color: var(--color-text);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            cursor: pointer;
            transition: all 0.2s;
        }

        button:hover {
            background-color: var(--color-secondary-hover);
        }

        button.active {
            background-color: var(--color-primary);
            color: var(--color-btn-primary-text);
            border-color: var(--color-primary);
        }

        .value-display {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
            margin-top: var(--space-4);
        }

        #toggle-controls {
            position: absolute;
            top: var(--space-20);
            right: var(--space-20);
            z-index: 100;
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            padding: var(--space-12);
            border-radius: var(--radius-base);
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text);
        }

        #toggle-controls:hover {
            background-color: var(--color-secondary-hover);
        }

        h1 {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-20);
            color: var(--color-text);
        }

        .section-title {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-12);
            color: var(--color-text);
            border-bottom: 1px solid var(--color-border);
            padding-bottom: var(--space-8);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: var(--space-8);
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        @font-face {
            font-family: 'FKGroteskNeue';
            src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2') format('woff2');
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="canvas-container">
            <canvas id="airportCanvas"></canvas>
            <button id="toggle-controls">â˜° Controls</button>
        </div>
        <div id="controls">
            <h1>Airport View Controls</h1>

            <div class="control-group">
                <div class="section-title">Time of Day</div>
                <label class="control-label">Hour (0-24)</label>
                <input type="range" id="time-slider" min="0" max="24" step="0.5" value="12">
                <div class="value-display" id="time-display">12:00</div>
            </div>

            <div class="control-group">
                <div class="section-title">Scenery</div>
                <label class="control-label">Select Environment</label>
                <select id="scenery-select">
                    <option value="0">Standard Airport</option>
                    <option value="1">Sunrise Airport</option>
                    <option value="2">Midnight Airport</option>
                    <option value="3">Stormy Airport</option>
                    <option value="4">Tropical Airport</option>
                    <option value="5">Winter Airport</option>
                    <option value="6">Industrial Airport</option>
                </select>
            </div>

            <div class="control-group">
                <div class="section-title">Animation</div>
                <label class="control-label">Speed</label>
                <input type="range" id="speed-slider" min="0.2" max="3" step="0.1" value="1">
                <div class="value-display" id="speed-display">Normal</div>
            </div>

            <div class="control-group">
                <label class="control-label">Aircraft Density</label>
                <div class="button-group">
                    <button class="density-btn" data-density="3">Few</button>
                    <button class="density-btn active" data-density="6">Normal</button>
                    <button class="density-btn" data-density="10">Busy</button>
                </div>
            </div>

            <div class="control-group">
                <div class="section-title">Weather</div>
                <label class="control-label">Weather Effect</label>
                <div class="button-group">
                    <button class="weather-btn active" data-weather="clear">Clear</button>
                    <button class="weather-btn" data-weather="rain">Rain</button>
                    <button class="weather-btn" data-weather="fog">Fog</button>
                    <button class="weather-btn" data-weather="haze">Haze</button>
                </div>
            </div>

            <div class="control-group">
                <div class="section-title">Camera</div>
                <label class="control-label">View Mode</label>
                <div class="button-group">
                    <button class="camera-btn active" data-camera="0">Ground</button>
                    <button class="camera-btn" data-camera="1">Tower</button>
                    <button class="camera-btn" data-camera="2">Distant</button>
                    <button class="camera-btn" data-camera="3">Cockpit</button>
                </div>
            </div>

            <div class="control-group">
                <div class="section-title">Color Theme</div>
                <label class="control-label">Color Palette</label>
                <select id="theme-select">
                    <option value="0">Realistic</option>
                    <option value="1">Warm</option>
                    <option value="2">Cool</option>
                    <option value="3">Neon</option>
                </select>
            </div>

            <div class="control-group">
                <div class="section-title">Audio</div>
                <div class="checkbox-group">
                    <input type="checkbox" id="audio-toggle">
                    <label class="control-label" for="audio-toggle" style="margin: 0;">Ambient Sounds</label>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration Data
const sceneries = [
    {
        name: "Standard Airport",
        skyGradient: {
            day: ["#87CEEB", "#E0F6FF"],
            sunrise: ["#FF6B35", "#FFB84D"],
            sunset: ["#FF6B35", "#C92A2A"],
            night: ["#0B1929", "#1A1A3E"]
        },
        terminalColor: "#E8E8E8",
        runwayColor: "#404040",
        lightColor: "#FFFF00"
    },
    {
        name: "Sunrise Airport",
        skyGradient: {
            day: ["#FFD700", "#FFA500"],
            sunrise: ["#FF4500", "#FFD700"],
            sunset: ["#FF8C00", "#FF6347"],
            night: ["#1A1A1A", "#2F1B3C"]
        },
        terminalColor: "#FFF8DC",
        runwayColor: "#555555",
        lightColor: "#FFD700"
    },
    {
        name: "Midnight Airport",
        skyGradient: {
            day: ["#000000", "#1A1A2E"],
            sunrise: ["#0F0F1E", "#1A1A2E"],
            sunset: ["#0F0F1E", "#1A1A2E"],
            night: ["#0A0A14", "#0F0F1E"]
        },
        terminalColor: "#1A1A1A",
        runwayColor: "#222222",
        lightColor: "#00FF00"
    },
    {
        name: "Stormy Airport",
        skyGradient: {
            day: ["#696969", "#808080"],
            sunrise: ["#808080", "#696969"],
            sunset: ["#696969", "#555555"],
            night: ["#2F2F2F", "#404040"]
        },
        terminalColor: "#CCCCCC",
        runwayColor: "#333333",
        lightColor: "#FFAA00"
    },
    {
        name: "Tropical Airport",
        skyGradient: {
            day: ["#00BFFF", "#87CEEB"],
            sunrise: ["#FFB84D", "#87CEEB"],
            sunset: ["#FF6347", "#FFB84D"],
            night: ["#001a4d", "#003366"]
        },
        terminalColor: "#F5F5DC",
        runwayColor: "#505050",
        lightColor: "#FFFF99"
    },
    {
        name: "Winter Airport",
        skyGradient: {
            day: ["#B0C4DE", "#E0E6FF"],
            sunrise: ["#D3D3D3", "#E0E6FF"],
            sunset: ["#C0C0C0", "#D3D3D3"],
            night: ["#1A1A3E", "#2F2F5F"]
        },
        terminalColor: "#FFFAF0",
        runwayColor: "#505050",
        lightColor: "#87CEEB"
    },
    {
        name: "Industrial Airport",
        skyGradient: {
            day: ["#778899", "#9DABCC"],
            sunrise: ["#FF8C00", "#778899"],
            sunset: ["#FF6347", "#778899"],
            night: ["#1F1F2E", "#2A2A3E"]
        },
        terminalColor: "#D3D3D3",
        runwayColor: "#333333",
        lightColor: "#FF4500"
    }
];

const cameraModes = [
    { name: "Ground Level", xOffset: 0, yOffset: 150, scale: 1 },
    { name: "Tower View", xOffset: 0, yOffset: -100, scale: 1.2 },
    { name: "Distant View", xOffset: 0, yOffset: -50, scale: 0.8 },
    { name: "Cockpit View", xOffset: 100, yOffset: 80, scale: 1.5 }
];

const colorThemes = [
    { name: "Realistic", adjustment: 1.0, hueShift: 0 },
    { name: "Warm", adjustment: 1.3, hueShift: 15 },
    { name: "Cool", adjustment: 1.1, hueShift: -30 },
    { name: "Neon", adjustment: 1.5, hueShift: 0, saturation: 1.8 }
];

const aircraftTypes = [
    { name: "Boeing 747", width: 80, height: 20, color: "#FFFFFF" },
    { name: "Airbus A380", width: 85, height: 22, color: "#E8E8E8" },
    { name: "Regional Jet", width: 50, height: 15, color: "#D3D3D3" },
    { name: "Cargo Plane", width: 75, height: 18, color: "#CCCC99" }
];

// Application State
let state = {
    timeOfDay: 12,
    sceneryIndex: 0,
    animationSpeed: 1,
    aircraftDensity: 6,
    weather: "clear",
    cameraMode: 0,
    colorTheme: 0,
    audioEnabled: false,
    controlsVisible: true
};

// Canvas and Animation
let canvas, ctx;
let width, height;
let animationFrame;

// Dynamic Elements
let clouds = [];
let aircraft = [];
let raindrops = [];
let stars = [];
let runwayLights = [];

// Audio Context
let audioContext;
let audioOscillator;
let audioGain;

// Initialize Application
function init() {
    canvas = document.getElementById('airportCanvas');
    ctx = canvas.getContext('2d');
    
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    initializeElements();
    setupEventListeners();
    animate();
}

function resizeCanvas() {
    width = canvas.offsetWidth;
    height = canvas.offsetHeight;
    canvas.width = width;
    canvas.height = height;
}

function initializeElements() {
    // Initialize clouds
    clouds = [];
    for (let i = 0; i < 8; i++) {
        clouds.push({
            x: Math.random() * width,
            y: Math.random() * height * 0.3,
            width: 80 + Math.random() * 120,
            height: 40 + Math.random() * 60,
            speed: 0.2 + Math.random() * 0.3,
            opacity: 0.4 + Math.random() * 0.3
        });
    }
    
    // Initialize stars
    stars = [];
    for (let i = 0; i < 100; i++) {
        stars.push({
            x: Math.random() * width,
            y: Math.random() * height * 0.5,
            size: Math.random() * 2,
            twinkle: Math.random() * Math.PI * 2,
            twinkleSpeed: 0.02 + Math.random() * 0.03
        });
    }
    
    // Initialize runway lights
    runwayLights = [];
    const lightCount = 20;
    for (let i = 0; i < lightCount; i++) {
        runwayLights.push({
            x: width * 0.3 + (i * 30),
            y: height * 0.7 + (i * 5),
            pulse: Math.random() * Math.PI * 2
        });
    }
    
    // Initialize aircraft
    updateAircraftCount();
}

function updateAircraftCount() {
    aircraft = [];
    for (let i = 0; i < state.aircraftDensity; i++) {
        const type = aircraftTypes[Math.floor(Math.random() * aircraftTypes.length)];
        const pathType = Math.random();
        aircraft.push({
            x: Math.random() * width,
            y: height * 0.5 + Math.random() * height * 0.3,
            ...type,
            speed: 0.3 + Math.random() * 0.5,
            pathType: pathType < 0.33 ? 'takeoff' : pathType < 0.66 ? 'landing' : 'taxi',
            progress: Math.random(),
            altitude: pathType < 0.33 ? 0 : pathType < 0.66 ? 100 : 0
        });
    }
}

function setupEventListeners() {
    // Time of day slider
    const timeSlider = document.getElementById('time-slider');
    const timeDisplay = document.getElementById('time-display');
    timeSlider.addEventListener('input', (e) => {
        state.timeOfDay = parseFloat(e.target.value);
        const hours = Math.floor(state.timeOfDay);
        const minutes = Math.floor((state.timeOfDay % 1) * 60);
        timeDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
    });
    
    // Scenery selector
    document.getElementById('scenery-select').addEventListener('change', (e) => {
        state.sceneryIndex = parseInt(e.target.value);
    });
    
    // Animation speed
    const speedSlider = document.getElementById('speed-slider');
    const speedDisplay = document.getElementById('speed-display');
    speedSlider.addEventListener('input', (e) => {
        state.animationSpeed = parseFloat(e.target.value);
        const labels = ['Very Slow', 'Slow', 'Normal', 'Fast', 'Very Fast'];
        const index = Math.min(4, Math.floor((state.animationSpeed - 0.2) / 0.7 * 5));
        speedDisplay.textContent = labels[index];
    });
    
    // Aircraft density
    document.querySelectorAll('.density-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            document.querySelectorAll('.density-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            state.aircraftDensity = parseInt(e.target.dataset.density);
            updateAircraftCount();
        });
    });
    
    // Weather buttons
    document.querySelectorAll('.weather-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            document.querySelectorAll('.weather-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            state.weather = e.target.dataset.weather;
            if (state.weather === 'rain') {
                initRain();
            }
        });
    });
    
    // Camera buttons
    document.querySelectorAll('.camera-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            document.querySelectorAll('.camera-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            state.cameraMode = parseInt(e.target.dataset.camera);
        });
    });
    
    // Color theme
    document.getElementById('theme-select').addEventListener('change', (e) => {
        state.colorTheme = parseInt(e.target.value);
    });
    
    // Audio toggle
    document.getElementById('audio-toggle').addEventListener('change', (e) => {
        state.audioEnabled = e.target.checked;
        if (state.audioEnabled) {
            startAmbientAudio();
        } else {
            stopAmbientAudio();
        }
    });
    
    // Toggle controls
    document.getElementById('toggle-controls').addEventListener('click', () => {
        state.controlsVisible = !state.controlsVisible;
        const controls = document.getElementById('controls');
        controls.classList.toggle('hidden', !state.controlsVisible);
    });
}

function initRain() {
    raindrops = [];
    for (let i = 0; i < 200; i++) {
        raindrops.push({
            x: Math.random() * width,
            y: Math.random() * height,
            speed: 5 + Math.random() * 5,
            length: 10 + Math.random() * 20
        });
    }
}

function startAmbientAudio() {
    try {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            audioOscillator = audioContext.createOscillator();
            audioGain = audioContext.createGain();
            
            audioOscillator.type = 'sine';
            audioOscillator.frequency.setValueAtTime(60, audioContext.currentTime);
            audioGain.gain.setValueAtTime(0.02, audioContext.currentTime);
            
            audioOscillator.connect(audioGain);
            audioGain.connect(audioContext.destination);
            audioOscillator.start();
        }
    } catch (e) {
        console.log('Audio not available');
    }
}

function stopAmbientAudio() {
    if (audioContext && audioOscillator) {
        audioGain.gain.setValueAtTime(0, audioContext.currentTime);
    }
}

// Drawing Functions
function drawSky() {
    const scenery = sceneries[state.sceneryIndex];
    const theme = colorThemes[state.colorTheme];
    
    let colors;
    if (state.timeOfDay >= 0 && state.timeOfDay < 6) {
        colors = scenery.skyGradient.night;
    } else if (state.timeOfDay >= 6 && state.timeOfDay < 9) {
        colors = scenery.skyGradient.sunrise;
    } else if (state.timeOfDay >= 9 && state.timeOfDay < 17) {
        colors = scenery.skyGradient.day;
    } else if (state.timeOfDay >= 17 && state.timeOfDay < 20) {
        colors = scenery.skyGradient.sunset;
    } else {
        colors = scenery.skyGradient.night;
    }
    
    const gradient = ctx.createLinearGradient(0, 0, 0, height);
    gradient.addColorStop(0, applyColorTheme(colors[0], theme));
    gradient.addColorStop(1, applyColorTheme(colors[1], theme));
    
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, width, height);
}

function drawStars() {
    if (state.timeOfDay < 6 || state.timeOfDay > 19) {
        const opacity = state.timeOfDay < 6 ? 1 : state.timeOfDay > 22 ? 1 : (24 - state.timeOfDay) / 5;
        stars.forEach(star => {
            const twinkle = Math.sin(star.twinkle) * 0.5 + 0.5;
            ctx.fillStyle = `rgba(255, 255, 255, ${opacity * twinkle})`;
            ctx.beginPath();
            ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
            ctx.fill();
            star.twinkle += star.twinkleSpeed;
        });
    }
}

function drawClouds() {
    const camera = cameraModes[state.cameraMode];
    const isNight = state.timeOfDay < 6 || state.timeOfDay > 19;
    
    clouds.forEach(cloud => {
        const cloudColor = isNight ? 'rgba(50, 50, 80, 0.4)' : `rgba(255, 255, 255, ${cloud.opacity})`;
        
        ctx.save();
        ctx.translate(cloud.x, cloud.y);
        ctx.scale(camera.scale, camera.scale);
        
        ctx.fillStyle = cloudColor;
        ctx.beginPath();
        ctx.ellipse(0, 0, cloud.width / 2, cloud.height / 2, 0, 0, Math.PI * 2);
        ctx.ellipse(cloud.width / 4, -cloud.height / 4, cloud.width / 3, cloud.height / 3, 0, 0, Math.PI * 2);
        ctx.ellipse(-cloud.width / 4, -cloud.height / 4, cloud.width / 3, cloud.height / 3, 0, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.restore();
        
        cloud.x += cloud.speed * state.animationSpeed;
        if (cloud.x > width + cloud.width) {
            cloud.x = -cloud.width;
        }
    });
}

function drawGround() {
    const scenery = sceneries[state.sceneryIndex];
    const theme = colorThemes[state.colorTheme];
    const camera = cameraModes[state.cameraMode];
    
    ctx.save();
    ctx.translate(camera.xOffset, camera.yOffset);
    ctx.scale(camera.scale, camera.scale);
    
    // Ground
    const groundGradient = ctx.createLinearGradient(0, height * 0.6, 0, height);
    groundGradient.addColorStop(0, applyColorTheme('#4A7C59', theme));
    groundGradient.addColorStop(1, applyColorTheme('#2D5A3D', theme));
    ctx.fillStyle = groundGradient;
    ctx.fillRect(0, height * 0.6, width, height * 0.4);
    
    ctx.restore();
}

function drawRunway() {
    const scenery = sceneries[state.sceneryIndex];
    const camera = cameraModes[state.cameraMode];
    
    ctx.save();
    ctx.translate(camera.xOffset, camera.yOffset);
    ctx.scale(camera.scale, camera.scale);
    
    // Main runway
    ctx.fillStyle = scenery.runwayColor;
    ctx.beginPath();
    ctx.moveTo(width * 0.2, height * 0.65);
    ctx.lineTo(width * 0.8, height * 0.75);
    ctx.lineTo(width * 0.85, height * 0.78);
    ctx.lineTo(width * 0.15, height * 0.68);
    ctx.closePath();
    ctx.fill();
    
    // Runway markings
    ctx.strokeStyle = '#FFFFFF';
    ctx.lineWidth = 2;
    for (let i = 0; i < 10; i++) {
        const t = i / 10;
        const x1 = width * 0.2 + (width * 0.6 * t);
        const y1 = height * 0.65 + (height * 0.1 * t);
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x1 + 20, y1);
        ctx.stroke();
    }
    
    ctx.restore();
}

function drawRunwayLights() {
    const scenery = sceneries[state.sceneryIndex];
    const camera = cameraModes[state.cameraMode];
    const isNight = state.timeOfDay < 7 || state.timeOfDay > 18;
    const lightIntensity = isNight ? 1 : Math.max(0, (20 - state.timeOfDay) / 2);
    
    if (lightIntensity > 0.1) {
        ctx.save();
        ctx.translate(camera.xOffset, camera.yOffset);
        ctx.scale(camera.scale, camera.scale);
        
        runwayLights.forEach(light => {
            const pulse = Math.sin(light.pulse) * 0.3 + 0.7;
            const opacity = lightIntensity * pulse;
            
            ctx.fillStyle = scenery.lightColor;
            ctx.globalAlpha = opacity;
            ctx.beginPath();
            ctx.arc(light.x, light.y, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // Glow effect
            const gradient = ctx.createRadialGradient(light.x, light.y, 0, light.x, light.y, 15);
            gradient.addColorStop(0, scenery.lightColor);
            gradient.addColorStop(1, 'rgba(255, 255, 0, 0)');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(light.x, light.y, 15, 0, Math.PI * 2);
            ctx.fill();
            
            light.pulse += 0.02;
        });
        
        ctx.globalAlpha = 1;
        ctx.restore();
    }
}

function drawTerminal() {
    const scenery = sceneries[state.sceneryIndex];
    const theme = colorThemes[state.colorTheme];
    const camera = cameraModes[state.cameraMode];
    const isNight = state.timeOfDay < 6 || state.timeOfDay > 19;
    
    ctx.save();
    ctx.translate(camera.xOffset, camera.yOffset);
    ctx.scale(camera.scale, camera.scale);
    
    // Main terminal building
    ctx.fillStyle = applyColorTheme(scenery.terminalColor, theme);
    ctx.fillRect(width * 0.05, height * 0.45, 200, 100);
    
    // Windows
    const windowColor = isNight ? '#FFF8B0' : '#4A90A4';
    for (let row = 0; row < 5; row++) {
        for (let col = 0; col < 8; col++) {
            ctx.fillStyle = windowColor;
            ctx.fillRect(width * 0.05 + 10 + col * 23, height * 0.45 + 10 + row * 18, 18, 14);
        }
    }
    
    // Control tower
    ctx.fillStyle = applyColorTheme(scenery.terminalColor, theme);
    ctx.fillRect(width * 0.15, height * 0.35, 40, 110);
    ctx.fillRect(width * 0.13, height * 0.32, 44, 25);
    
    // Tower windows
    ctx.fillStyle = windowColor;
    ctx.fillRect(width * 0.14, height * 0.33, 38, 20);
    
    // Distant buildings
    ctx.globalAlpha = 0.6;
    ctx.fillStyle = applyColorTheme('#B0B0B0', theme);
    ctx.fillRect(width * 0.6, height * 0.5, 100, 60);
    ctx.fillRect(width * 0.75, height * 0.48, 80, 70);
    ctx.globalAlpha = 1;
    
    ctx.restore();
}

function drawAircraft() {
    const camera = cameraModes[state.cameraMode];
    
    ctx.save();
    ctx.translate(camera.xOffset, camera.yOffset);
    ctx.scale(camera.scale, camera.scale);
    
    aircraft.forEach(plane => {
        ctx.save();
        
        // Update aircraft position based on path type
        if (plane.pathType === 'takeoff') {
            plane.progress += 0.002 * state.animationSpeed;
            plane.x = width * 0.3 + plane.progress * width * 0.6;
            plane.y = height * 0.7 - (plane.progress * plane.progress * height * 0.4);
            plane.altitude = plane.progress * 200;
        } else if (plane.pathType === 'landing') {
            plane.progress += 0.002 * state.animationSpeed;
            const reverseProgress = 1 - plane.progress;
            plane.x = width * 0.9 - plane.progress * width * 0.6;
            plane.y = height * 0.3 + (plane.progress * plane.progress * height * 0.4);
            plane.altitude = reverseProgress * reverseProgress * 200;
        } else {
            plane.x += plane.speed * state.animationSpeed;
            plane.y = height * 0.72;
        }
        
        // Reset if off screen
        if (plane.progress > 1 || plane.x > width + 100 || plane.x < -100) {
            plane.progress = 0;
            plane.x = plane.pathType === 'taxi' ? -50 : width * 0.3;
            plane.y = height * 0.72;
        }
        
        // Draw aircraft
        ctx.translate(plane.x, plane.y);
        
        // Scale based on altitude (perspective)
        const scale = 1 + (plane.altitude / 400);
        ctx.scale(scale, scale);
        
        // Fuselage
        ctx.fillStyle = plane.color;
        ctx.fillRect(-plane.width / 2, -plane.height / 2, plane.width, plane.height);
        
        // Wings
        ctx.fillStyle = plane.color;
        ctx.fillRect(-plane.width / 3, -plane.height / 2 - 10, plane.width / 1.5, 10);
        
        // Tail
        ctx.beginPath();
        ctx.moveTo(plane.width / 2 - 10, -plane.height / 2);
        ctx.lineTo(plane.width / 2 - 10, -plane.height / 2 - 15);
        ctx.lineTo(plane.width / 2, -plane.height / 2 - 15);
        ctx.lineTo(plane.width / 2, -plane.height / 2);
        ctx.fill();
        
        // Windows
        ctx.fillStyle = '#4A90A4';
        for (let i = 0; i < 8; i++) {
            ctx.fillRect(-plane.width / 2 + 10 + i * 8, -plane.height / 2 + 5, 4, 4);
        }
        
        ctx.restore();
    });
    
    ctx.restore();
}

function drawWeather() {
    if (state.weather === 'rain' && raindrops.length > 0) {
        ctx.strokeStyle = 'rgba(174, 194, 224, 0.6)';
        ctx.lineWidth = 1;
        raindrops.forEach(drop => {
            ctx.beginPath();
            ctx.moveTo(drop.x, drop.y);
            ctx.lineTo(drop.x - 2, drop.y + drop.length);
            ctx.stroke();
            
            drop.y += drop.speed * state.animationSpeed;
            drop.x -= 1 * state.animationSpeed;
            
            if (drop.y > height) {
                drop.y = 0;
                drop.x = Math.random() * width;
            }
        });
    } else if (state.weather === 'fog') {
        ctx.fillStyle = 'rgba(200, 200, 210, 0.3)';
        ctx.fillRect(0, 0, width, height);
    } else if (state.weather === 'haze') {
        ctx.fillStyle = 'rgba(220, 210, 190, 0.2)';
        ctx.fillRect(0, 0, width, height);
    }
}

function applyColorTheme(color, theme) {
    if (theme.adjustment === 1.0 && !theme.hueShift) return color;
    
    // Simple color adjustment - in a real app, you'd parse and modify RGB/HSL values
    return color;
}

// Main Animation Loop
function animate() {
    ctx.clearRect(0, 0, width, height);
    
    drawSky();
    drawStars();
    drawClouds();
    drawGround();
    drawTerminal();
    drawRunway();
    drawRunwayLights();
    drawAircraft();
    drawWeather();
    
    animationFrame = requestAnimationFrame(animate);
}

// Start the application
window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>