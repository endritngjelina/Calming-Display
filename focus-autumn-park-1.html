<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Windy Autumn Park</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-white);
            --color-text: var(--color-charcoal-700);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-border: rgba(94, 82, 64, 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --font-family-base: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --radius-base: 8px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04);
            --duration-normal: 250ms;
            --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: var(--font-family-base);
            background: #1a1a1a;
        }

        #canvas-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: linear-gradient(to bottom, #87a96b 0%, #d4a574 40%, #8b7355 100%);
        }

        /* Sky with clouds */
        #sky {
            position: absolute;
            top: 0;
            width: 100%;
            height: 45%;
            background: linear-gradient(to bottom, #b8c5d6 0%, #d4c8b8 50%, #d4a574 100%);
            transition: background 0.8s ease;
        }

        /* Distant hills for depth */
        #hills {
            position: absolute;
            top: 40%;
            width: 100%;
            height: 15%;
            background: linear-gradient(to bottom, rgba(130, 140, 120, 0.6) 0%, rgba(110, 120, 100, 0.4) 100%);
            clip-path: ellipse(100% 100% at 50% 100%);
            filter: blur(2px);
            opacity: 0.7;
        }

        /* Ground with texture */
        #ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 40%;
            background: linear-gradient(to bottom, #8b7766 0%, #6b5d4f 50%, #4a3f38 100%);
            transition: background 0.8s ease;
        }

        /* Ground texture overlay */
        #ground::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(0,0,0,0.1) 1px, transparent 1px),
                radial-gradient(circle at 60% 70%, rgba(0,0,0,0.08) 1px, transparent 1px),
                radial-gradient(circle at 40% 90%, rgba(0,0,0,0.05) 1px, transparent 1px);
            background-size: 50px 50px, 70px 70px, 90px 90px;
            opacity: 0.4;
        }

        /* Path with perspective */
        #path {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 45%;
            height: 45%;
            background: linear-gradient(to bottom, 
                #a89080 0%, 
                #9a8070 20%,
                #8a7060 40%,
                #7a6050 60%,
                #6a5040 80%,
                #5a4838 100%);
            clip-path: polygon(25% 100%, 75% 100%, 95% 0%, 5% 0%);
            box-shadow: inset 0 0 40px rgba(0,0,0,0.2);
        }

        /* Path texture */
        #path::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(90deg, transparent 49%, rgba(255,255,255,0.03) 50%, transparent 51%),
                radial-gradient(circle at 30% 40%, rgba(0,0,0,0.1) 1px, transparent 2px),
                radial-gradient(circle at 70% 60%, rgba(0,0,0,0.08) 1px, transparent 2px);
            background-size: 8px 8px, 40px 40px, 60px 60px;
        }

        /* Path edges/cracks */
        #path::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, 
                rgba(0,0,0,0) 0%, 
                rgba(0,0,0,0.05) 40%,
                rgba(0,0,0,0.15) 100%);
        }

        /* Trees container */
        #trees-container {
            position: absolute;
            bottom: 30%;
            left: 0;
            right: 0;
            width: 100%;
            height: 70%;
            pointer-events: none;
        }

        .tree {
            position: absolute;
            bottom: 0;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.3));
        }

        .tree-trunk {
            background: linear-gradient(to right, #5a4a3a 0%, #6a5a4a 50%, #5a4a3a 100%);
            border-radius: 3px;
            margin: 0 auto;
            position: relative;
        }

        .tree-trunk::before {
            content: '';
            position: absolute;
            top: 10%;
            left: 5%;
            width: 20%;
            height: 60%;
            background: rgba(0,0,0,0.15);
            border-radius: 2px;
        }

        .tree-foliage {
            position: relative;
            margin: 0 auto;
            overflow: visible;
        }

        /* Multiple foliage layers for depth */
        .foliage-layer {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, 
                rgba(220, 180, 100, 0.9) 0%, 
                rgba(180, 140, 80, 0.8) 40%, 
                rgba(140, 110, 70, 0.9) 100%);
            animation: sway-foliage 4s ease-in-out infinite;
        }

        .foliage-layer:nth-child(1) {
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            animation-delay: 0s;
        }

        .foliage-layer:nth-child(2) {
            width: 85%;
            height: 85%;
            top: 10%;
            left: 15%;
            animation-delay: 0.5s;
            background: radial-gradient(circle at 40% 40%, 
                rgba(210, 170, 90, 0.85) 0%, 
                rgba(170, 130, 70, 0.75) 100%);
        }

        .foliage-layer:nth-child(3) {
            width: 75%;
            height: 75%;
            top: 5%;
            left: 5%;
            animation-delay: 1s;
            background: radial-gradient(circle at 50% 50%, 
                rgba(200, 160, 80, 0.8) 0%, 
                rgba(160, 120, 60, 0.7) 100%);
        }

        /* Lamps */
        #lamps-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: 50%;
        }

        .lamp {
            position: absolute;
            bottom: 0;
            filter: drop-shadow(2px 4px 8px rgba(0,0,0,0.4));
        }

        .lamp-post {
            width: 4px;
            height: 140px;
            background: linear-gradient(to right, #2a2a2a 0%, #4a4a4a 50%, #2a2a2a 100%);
            margin: 0 auto;
            border-radius: 2px;
            position: relative;
        }

        .lamp-post::before {
            content: '';
            position: absolute;
            left: -1px;
            top: 0;
            width: 2px;
            height: 100%;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
        }

        .lamp-head {
            position: relative;
            width: 35px;
            height: 28px;
            background: linear-gradient(to bottom, #5a5a5a 0%, #4a4a4a 100%);
            border-radius: 6px 6px 0 0;
            margin: 0 auto;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
            transition: all 0.5s ease;
        }

        .lamp-head::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            height: 8px;
            background: rgba(100,100,100,0.8);
            border-radius: 0 0 4px 4px;
        }

        .lamp-glow {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            background: radial-gradient(ellipse at center, 
                rgba(255, 220, 150, 0.6) 0%, 
                rgba(255, 200, 100, 0.3) 30%,
                rgba(255, 180, 80, 0.1) 60%,
                transparent 100%);
            border-radius: 50%;
            opacity: 0;
            transition: all 0.5s ease;
            pointer-events: none;
        }

        .lamp-head.lit {
            box-shadow: inset 0 0 20px rgba(255,220,150,0.8),
                        0 0 30px rgba(255,200,100,0.4);
            background: linear-gradient(to bottom, #6a6a4a 0%, #5a5a3a 100%);
        }

        .lamp-head.lit .lamp-glow {
            width: 200px;
            height: 200px;
            opacity: 1;
        }

        /* Benches */
        #benches-container {
            position: absolute;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            height: 20%;
        }

        .bench {
            position: absolute;
            bottom: 5%;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.4));
        }

        .bench-back {
            width: 70px;
            height: 35px;
            background: linear-gradient(to bottom, #6a5a4a 0%, #5a4a3a 100%);
            border-radius: 4px;
            margin: 0 auto;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .bench-back::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 10%;
            width: 80%;
            height: 3px;
            background: rgba(0,0,0,0.2);
            border-radius: 2px;
        }

        .bench-back::after {
            content: '';
            position: absolute;
            bottom: 8px;
            left: 10%;
            width: 80%;
            height: 3px;
            background: rgba(0,0,0,0.2);
            border-radius: 2px;
        }

        .bench-seat {
            width: 80px;
            height: 14px;
            background: linear-gradient(to bottom, #8a7a6a 0%, #7a6a5a 100%);
            border-radius: 3px;
            margin: -6px auto 0;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
            position: relative;
        }

        .bench-seat::before {
            content: '';
            position: absolute;
            top: 3px;
            left: 5%;
            width: 90%;
            height: 2px;
            background: rgba(255,255,255,0.1);
            border-radius: 1px;
        }

        .bench-legs {
            position: absolute;
            bottom: -25px;
            width: 100%;
            height: 25px;
        }

        .bench-leg {
            position: absolute;
            width: 4px;
            height: 100%;
            background: linear-gradient(to right, #4a3a2a 0%, #5a4a3a 50%, #4a3a2a 100%);
            border-radius: 2px;
        }

        .bench-leg:nth-child(1) { left: 15%; }
        .bench-leg:nth-child(2) { right: 15%; }

        /* Leaves container */
        #leaves-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }

        .leaf {
            position: absolute;
            filter: drop-shadow(1px 2px 2px rgba(0,0,0,0.3));
            will-change: transform;
        }

        /* Different leaf shapes */
        .leaf-shape-1 {
            clip-path: polygon(50% 0%, 75% 25%, 100% 50%, 75% 75%, 50% 100%, 25% 75%, 0% 50%, 25% 25%);
        }

        .leaf-shape-2 {
            clip-path: ellipse(45% 50% at 50% 50%);
        }

        .leaf-shape-3 {
            border-radius: 50% 0 50% 50%;
        }

        .leaf-shape-4 {
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
        }

        /* Atmospheric particles */
        #particles-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            animation: float-particle linear infinite;
        }

        /* Depth fog overlay */
        #fog-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, 
                rgba(200, 210, 220, 0) 0%,
                rgba(200, 210, 220, 0.1) 40%,
                rgba(180, 190, 200, 0.15) 70%,
                rgba(160, 170, 180, 0.2) 100%);
            pointer-events: none;
            opacity: 0.3;
            transition: opacity 0.8s ease;
        }

        /* Control panel */
        .control-panel {
            position: fixed;
            bottom: var(--space-16);
            right: var(--space-16);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            padding: var(--space-16);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            max-width: 340px;
            max-height: 85vh;
            overflow-y: auto;
            z-index: 1000;
            font-size: 13px;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        .control-group {
            margin-bottom: var(--space-16);
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-label {
            display: block;
            font-weight: 600;
            margin-bottom: var(--space-8);
            color: var(--color-text);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-8);
        }

        button {
            padding: var(--space-8) var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            background: var(--color-surface);
            color: var(--color-text);
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all var(--duration-normal) var(--ease-standard);
            white-space: nowrap;
        }

        button:hover {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
            border-color: var(--color-primary);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        button.active {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
            border-color: var(--color-primary);
        }

        .range-input {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--color-border);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--color-primary);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .range-input::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--color-primary);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .value-display {
            display: inline-block;
            margin-left: var(--space-8);
            color: var(--color-text-secondary);
            font-size: 11px;
            font-weight: 600;
        }

        .color-input {
            width: 100%;
            height: 45px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            cursor: pointer;
        }

        @keyframes sway-foliage {
            0%, 100% { 
                transform: translateX(0) rotate(0deg) scale(1); 
            }
            25% { 
                transform: translateX(6px) rotate(2deg) scale(1.01); 
            }
            50% { 
                transform: translateX(0) rotate(0deg) scale(1); 
            }
            75% { 
                transform: translateX(-6px) rotate(-2deg) scale(1.01); 
            }
        }

        @keyframes float-leaf {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 0;
            }
            5% {
                opacity: 1;
            }
            95% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) translateX(var(--wind-x)) rotate(var(--rotation));
                opacity: 0;
            }
        }

        @keyframes float-particle {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(100vh) translateX(var(--drift-x));
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .control-panel {
                max-width: calc(100vw - 32px);
                bottom: var(--space-16);
                right: var(--space-16);
                left: var(--space-16);
            }
        }

        /* Hide scrollbar but keep functionality */
        .control-panel::-webkit-scrollbar {
            width: 6px;
        }

        .control-panel::-webkit-scrollbar-track {
            background: transparent;
        }

        .control-panel::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: 3px;
        }

        .control-panel::-webkit-scrollbar-thumb:hover {
            background: var(--color-gray-300);
        }
    </style>
</head>
<body>
    <div id="canvas-container">
        <div id="sky"></div>
        <div id="hills"></div>
        <div id="ground"></div>
        <div id="path"></div>
        
        <div id="trees-container"></div>
        <div id="lamps-container"></div>
        <div id="benches-container"></div>
        <div id="leaves-container"></div>
        <div id="particles-container"></div>
        <div id="fog-overlay"></div>
    </div>

    <div class="control-panel">
        <div class="control-group">
            <label class="control-label">Scenery</label>
            <div class="control-buttons">
                <button id="btn-autumn" class="active" data-scenery="autumn">Autumn</button>
                <button id="btn-winter" data-scenery="winter">Winter</button>
                <button id="btn-spring" data-scenery="spring">Spring</button>
                <button id="btn-sunset" data-scenery="sunset">Sunset</button>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label">Wind Strength</label>
            <input type="range" id="wind-speed" class="range-input" min="0" max="100" value="40">
            <span class="value-display"><span id="wind-display">40</span>%</span>
        </div>

        <div class="control-group">
            <label class="control-label">Leaf Density</label>
            <input type="range" id="leaf-density" class="range-input" min="10" max="100" value="45">
            <span class="value-display"><span id="density-display">45</span></span>
        </div>

        <div class="control-group">
            <label class="control-label">Animation Speed</label>
            <input type="range" id="animation-speed" class="range-input" min="30" max="200" value="100">
            <span class="value-display"><span id="speed-display">100</span>%</span>
        </div>

        <div class="control-group">
            <label class="control-label">Lamps</label>
            <div class="control-buttons">
                <button id="btn-lamps-off" class="active">Off</button>
                <button id="btn-lamps-on">On</button>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label">Atmospheric Particles</label>
            <div class="control-buttons">
                <button id="btn-particles-off">Off</button>
                <button id="btn-particles-on" class="active">On</button>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label">Depth Fog</label>
            <input type="range" id="fog-intensity" class="range-input" min="0" max="100" value="30">
            <span class="value-display"><span id="fog-display">30</span>%</span>
        </div>
    </div>

    <script>
        class EnhancedAutumnPark {
            constructor() {
                this.state = {
                    scenery: 'autumn',
                    windSpeed: 40,
                    leafDensity: 45,
                    animationSpeed: 100,
                    lampsOn: false,
                    particlesOn: true,
                    fogIntensity: 30
                };

                this.sceneries = {
                    autumn: {
                        skyGradient: 'linear-gradient(to bottom, #b8c5d6 0%, #d4c8b8 50%, #d4a574 100%)',
                        hillsGradient: 'linear-gradient(to bottom, rgba(130, 140, 120, 0.6) 0%, rgba(110, 120, 100, 0.4) 100%)',
                        groundGradient: 'linear-gradient(to bottom, #8b7766 0%, #6b5d4f 50%, #4a3f38 100%)',
                        pathGradient: 'linear-gradient(to bottom, #a89080 0%, #9a8070 20%, #8a7060 40%, #7a6050 60%, #6a5040 80%, #5a4838 100%)',
                        leafColors: ['#d4a574', '#c9a661', '#d4944f', '#b8875f', '#a68555', '#d4b874', '#e8b84d', '#c97a3a', '#d4865f', '#b87a55'],
                        foliageColors: ['rgba(220, 180, 100, 0.9)', 'rgba(210, 170, 90, 0.85)', 'rgba(200, 160, 80, 0.8)']
                    },
                    winter: {
                        skyGradient: 'linear-gradient(to bottom, #c8d4e8 0%, #b8c8d8 50%, #a8bfd8 100%)',
                        hillsGradient: 'linear-gradient(to bottom, rgba(180, 190, 200, 0.5) 0%, rgba(160, 170, 180, 0.3) 100%)',
                        groundGradient: 'linear-gradient(to bottom, #d8e0e8 0%, #c8d0d8 50%, #b8c0c8 100%)',
                        pathGradient: 'linear-gradient(to bottom, #c0c8d0 0%, #b0b8c0 20%, #a0a8b0 40%, #9098a0 60%, #808890 80%, #707880 100%)',
                        leafColors: ['#e8e8e8', '#d8d8d8', '#f0f0f0', '#c8c8c8', '#e0e0e0', '#f8f8f8', '#d0d0d0'],
                        foliageColors: ['rgba(160, 170, 180, 0.8)', 'rgba(150, 160, 170, 0.75)', 'rgba(140, 150, 160, 0.7)']
                    },
                    spring: {
                        skyGradient: 'linear-gradient(to bottom, #a8c8e8 0%, #c8d8e8 50%, #d4c8a8 100%)',
                        hillsGradient: 'linear-gradient(to bottom, rgba(140, 180, 120, 0.6) 0%, rgba(120, 160, 100, 0.4) 100%)',
                        groundGradient: 'linear-gradient(to bottom, #8a9d6c 0%, #7a9d5c 50%, #6a8d4c 100%)',
                        pathGradient: 'linear-gradient(to bottom, #a8b87d 0%, #98a86d 20%, #88985d 40%, #78884d 60%, #68783d 80%, #58682d 100%)',
                        leafColors: ['#c9e8a8', '#d4f0b8', '#b8d9a8', '#a8e8b8', '#d4e8b8', '#b8f0a8', '#c8e8c8', '#a8d8b8'],
                        foliageColors: ['rgba(160, 200, 120, 0.9)', 'rgba(150, 190, 110, 0.85)', 'rgba(140, 180, 100, 0.8)']
                    },
                    sunset: {
                        skyGradient: 'linear-gradient(to bottom, #ff9d7d 0%, #ff8d6d 50%, #ff7d5d 100%)',
                        hillsGradient: 'linear-gradient(to bottom, rgba(150, 100, 80, 0.6) 0%, rgba(130, 80, 60, 0.4) 100%)',
                        groundGradient: 'linear-gradient(to bottom, #9b6a4c 0%, #8b5a3c 50%, #7b4a2c 100%)',
                        pathGradient: 'linear-gradient(to bottom, #b88d5d 0%, #a87d4d 20%, #986d3d 40%, #885d2d 60%, #784d1d 80%, #683d0d 100%)',
                        leafColors: ['#ff9d6d', '#ff8d5d', '#ff7d4d', '#e8744d', '#d86d4d', '#ff8a5a', '#ff7a4a', '#e86a4a'],
                        foliageColors: ['rgba(230, 150, 100, 0.9)', 'rgba(220, 140, 90, 0.85)', 'rgba(210, 130, 80, 0.8)']
                    }
                };

                this.leaves = [];
                this.particles = [];
                this.windGustTimer = 0;
                this.currentWindMultiplier = 1;

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.createTrees();
                this.createLamps();
                this.createBenches();
                this.applyScenery('autumn');
                this.startLeafAnimation();
                this.startParticleAnimation();
                this.startWindGustAnimation();
            }

            setupEventListeners() {
                // Scenery buttons
                document.querySelectorAll('[data-scenery]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('[data-scenery]').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.applyScenery(e.target.dataset.scenery);
                    });
                });

                // Wind speed
                document.getElementById('wind-speed').addEventListener('input', (e) => {
                    this.state.windSpeed = parseInt(e.target.value);
                    document.getElementById('wind-display').textContent = this.state.windSpeed;
                });

                // Leaf density
                document.getElementById('leaf-density').addEventListener('input', (e) => {
                    this.state.leafDensity = parseInt(e.target.value);
                    document.getElementById('density-display').textContent = this.state.leafDensity;
                });

                // Animation speed
                document.getElementById('animation-speed').addEventListener('input', (e) => {
                    this.state.animationSpeed = parseInt(e.target.value);
                    document.getElementById('speed-display').textContent = this.state.animationSpeed;
                });

                // Lamps
                document.getElementById('btn-lamps-off').addEventListener('click', (e) => {
                    this.toggleLamps(false, e);
                });
                document.getElementById('btn-lamps-on').addEventListener('click', (e) => {
                    this.toggleLamps(true, e);
                });

                // Particles
                document.getElementById('btn-particles-off').addEventListener('click', (e) => {
                    this.toggleParticles(false, e);
                });
                document.getElementById('btn-particles-on').addEventListener('click', (e) => {
                    this.toggleParticles(true, e);
                });

                // Fog intensity
                document.getElementById('fog-intensity').addEventListener('input', (e) => {
                    this.state.fogIntensity = parseInt(e.target.value);
                    document.getElementById('fog-display').textContent = this.state.fogIntensity;
                    document.getElementById('fog-overlay').style.opacity = this.state.fogIntensity / 100;
                });
            }

            applyScenery(scenery) {
                this.state.scenery = scenery;
                const scene = this.sceneries[scenery];
                
                document.getElementById('sky').style.background = scene.skyGradient;
                document.getElementById('hills').style.background = scene.hillsGradient;
                document.getElementById('ground').style.background = scene.groundGradient;
                document.getElementById('path').style.background = scene.pathGradient;

                // Update tree foliage colors
                this.updateTreeColors(scene.foliageColors);
            }

            updateTreeColors(colors) {
                const foliageLayers = document.querySelectorAll('.foliage-layer');
                foliageLayers.forEach((layer, index) => {
                    const colorIndex = index % colors.length;
                    const color = colors[colorIndex];
                    if (color.includes('rgba')) {
                        layer.style.background = `radial-gradient(circle at ${30 + index * 10}% ${30 + index * 10}%, ${color} 0%, ${color.replace('0.9', '0.7').replace('0.85', '0.65').replace('0.8', '0.6')} 100%)`;
                    }
                });
            }

            createTrees() {
                const container = document.getElementById('trees-container');
                const treePositions = [
                    { left: 2, size: 'tiny', scale: 0.4, depth: 0.3 },
                    { left: 8, size: 'small', scale: 0.55, depth: 0.4 },
                    { left: 15, size: 'small', scale: 0.65, depth: 0.5 },
                    { left: 25, size: 'medium', scale: 0.8, depth: 0.65 },
                    { left: 40, size: 'large', scale: 1, depth: 0.85 },
                    { left: 55, size: 'large', scale: 1.05, depth: 0.9 },
                    { left: 70, size: 'medium', scale: 0.85, depth: 0.7 },
                    { left: 82, size: 'small', scale: 0.6, depth: 0.55 },
                    { left: 90, size: 'small', scale: 0.5, depth: 0.45 },
                    { left: 96, size: 'tiny', scale: 0.35, depth: 0.3 }
                ];

                treePositions.forEach(pos => {
                    const tree = document.createElement('div');
                    tree.className = 'tree';
                    tree.style.left = pos.left + '%';
                    tree.style.transform = `scale(${pos.scale})`;
                    tree.style.opacity = 0.3 + (pos.depth * 0.7);
                    tree.style.filter = `drop-shadow(2px 4px ${6 * pos.depth}px rgba(0,0,0,${0.2 + pos.depth * 0.2})) blur(${(1 - pos.depth) * 2}px)`;

                    const trunk = document.createElement('div');
                    trunk.className = 'tree-trunk';
                    const trunkHeight = 100 * pos.scale;
                    trunk.style.width = (8 * pos.scale) + 'px';
                    trunk.style.height = trunkHeight + 'px';

                    const foliage = document.createElement('div');
                    foliage.className = 'tree-foliage';
                    const foliageSize = 180 * pos.scale;
                    foliage.style.width = foliageSize + 'px';
                    foliage.style.height = foliageSize + 'px';
                    foliage.style.marginTop = (-30 * pos.scale) + 'px';

                    // Create multiple foliage layers for depth
                    for (let i = 0; i < 3; i++) {
                        const layer = document.createElement('div');
                        layer.className = 'foliage-layer';
                        foliage.appendChild(layer);
                    }

                    tree.appendChild(foliage);
                    tree.appendChild(trunk);
                    container.appendChild(tree);
                });
            }

            createLamps() {
                const container = document.getElementById('lamps-container');
                const lampPositions = [
                    { left: 12, scale: 0.7 },
                    { left: 28, scale: 0.85 },
                    { left: 50, scale: 1 },
                    { left: 72, scale: 0.85 },
                    { left: 88, scale: 0.7 }
                ];

                lampPositions.forEach(pos => {
                    const lamp = document.createElement('div');
                    lamp.className = 'lamp';
                    lamp.style.left = pos.left + '%';
                    lamp.style.transform = `scale(${pos.scale})`;

                    const post = document.createElement('div');
                    post.className = 'lamp-post';

                    const head = document.createElement('div');
                    head.className = 'lamp-head';

                    const glow = document.createElement('div');
                    glow.className = 'lamp-glow';
                    head.appendChild(glow);

                    lamp.appendChild(head);
                    lamp.appendChild(post);
                    container.appendChild(lamp);
                });
            }

            createBenches() {
                const container = document.getElementById('benches-container');
                const benchPositions = [
                    { left: 22, scale: 0.85 },
                    { left: 78, scale: 0.85 }
                ];

                benchPositions.forEach(pos => {
                    const bench = document.createElement('div');
                    bench.className = 'bench';
                    bench.style.left = pos.left + '%';
                    bench.style.transform = `translateX(-50%) scale(${pos.scale})`;

                    const back = document.createElement('div');
                    back.className = 'bench-back';

                    const seat = document.createElement('div');
                    seat.className = 'bench-seat';

                    const legs = document.createElement('div');
                    legs.className = 'bench-legs';
                    
                    for (let i = 0; i < 2; i++) {
                        const leg = document.createElement('div');
                        leg.className = 'bench-leg';
                        legs.appendChild(leg);
                    }

                    bench.appendChild(back);
                    bench.appendChild(seat);
                    bench.appendChild(legs);
                    container.appendChild(bench);
                });
            }

            toggleLamps(on, event) {
                this.state.lampsOn = on;
                document.querySelectorAll('#btn-lamps-off, #btn-lamps-on').forEach(b => b.classList.remove('active'));
                event.currentTarget.classList.add('active');

                const lampHeads = document.querySelectorAll('.lamp-head');
                lampHeads.forEach(head => {
                    if (on) {
                        head.classList.add('lit');
                    } else {
                        head.classList.remove('lit');
                    }
                });
            }

            toggleParticles(on, event) {
                this.state.particlesOn = on;
                document.querySelectorAll('#btn-particles-off, #btn-particles-on').forEach(b => b.classList.remove('active'));
                event.currentTarget.classList.add('active');

                if (!on) {
                    document.getElementById('particles-container').innerHTML = '';
                }
            }

            startWindGustAnimation() {
                setInterval(() => {
                    // Simulate wind gusts
                    this.currentWindMultiplier = 0.7 + Math.random() * 0.6;
                }, 2000 + Math.random() * 3000);
            }

            startLeafAnimation() {
                const container = document.getElementById('leaves-container');
                const leafShapes = ['leaf-shape-1', 'leaf-shape-2', 'leaf-shape-3', 'leaf-shape-4'];
                
                const createLeaf = () => {
                    const currentCount = document.querySelectorAll('.leaf').length;
                    if (currentCount >= this.state.leafDensity) {
                        return;
                    }

                    const leaf = document.createElement('div');
                    leaf.className = 'leaf ' + leafShapes[Math.floor(Math.random() * leafShapes.length)];
                    
                    const scene = this.sceneries[this.state.scenery];
                    const color = scene.leafColors[Math.floor(Math.random() * scene.leafColors.length)];
                    
                    const size = 12 + Math.random() * 18;
                    leaf.style.width = size + 'px';
                    leaf.style.height = size + 'px';
                    leaf.style.left = (Math.random() * 100) + '%';
                    leaf.style.top = '-' + size + 'px';
                    leaf.style.background = color;
                    leaf.style.opacity = 0.7 + Math.random() * 0.3;

                    // Calculate wind effect with gusts
                    const baseWind = this.state.windSpeed * this.currentWindMultiplier;
                    const windVariation = (Math.random() - 0.5) * 40;
                    const totalWind = baseWind + windVariation;
                    
                    const baseDuration = 100 / this.state.animationSpeed;
                    const durationVariation = (Math.random() - 0.5) * baseDuration * 0.4;
                    const duration = Math.max(3, (baseDuration + durationVariation) * 15);

                    const rotation = (Math.random() * 720) - 360;

                    leaf.style.setProperty('--wind-x', (totalWind * 5) + 'px');
                    leaf.style.setProperty('--rotation', rotation + 'deg');
                    leaf.style.animation = `float-leaf ${duration}s linear forwards`;

                    container.appendChild(leaf);

                    setTimeout(() => {
                        if (leaf.parentNode) {
                            leaf.remove();
                        }
                    }, duration * 1000);
                };

                setInterval(createLeaf, Math.max(100, 400 - this.state.leafDensity * 3));
            }

            startParticleAnimation() {
                const container = document.getElementById('particles-container');
                
                const createParticle = () => {
                    if (!this.state.particlesOn) return;
                    
                    const currentCount = document.querySelectorAll('.particle').length;
                    if (currentCount >= 20) return;

                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    
                    particle.style.left = (Math.random() * 100) + '%';
                    particle.style.top = '-5px';
                    particle.style.opacity = 0.2 + Math.random() * 0.4;

                    const drift = (Math.random() - 0.5) * 100;
                    const duration = 10 + Math.random() * 15;

                    particle.style.setProperty('--drift-x', drift + 'px');
                    particle.style.animation = `float-particle ${duration}s linear forwards`;

                    container.appendChild(particle);

                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.remove();
                        }
                    }, duration * 1000);
                };

                setInterval(createParticle, 800);
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            new EnhancedAutumnPark();
        });
    </script>
</body>
</html>