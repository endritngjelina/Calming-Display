<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Rain Street</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100%;
            height: 100vh;
            background: linear-gradient(to bottom, #4a5f7f 0%, #6b8ca8 50%, #8a9db8 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #canvas {
            flex: 1;
            display: block;
        }

        .controls {
            background: rgba(30, 40, 50, 0.95);
            padding: 16px;
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: center;
            border-top: 2px solid rgba(100, 150, 180, 0.3);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        }

        .control-group {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .control-group label {
            color: #a0c0e0;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .control-group select,
        .control-group input[type="range"],
        .control-group button {
            padding: 8px 12px;
            border: 1px solid rgba(100, 150, 180, 0.4);
            border-radius: 6px;
            background: rgba(50, 70, 90, 0.8);
            color: #e8f0f8;
            font-size: 13px;
            cursor: pointer;
            transition: all 250ms ease;
        }

        .control-group select:hover,
        .control-group button:hover {
            background: rgba(70, 100, 130, 0.9);
            border-color: rgba(100, 150, 180, 0.6);
        }

        .control-group select:focus,
        .control-group input[type="range"]:focus,
        .control-group button:focus {
            outline: 2px solid #6ba3d0;
            outline-offset: 2px;
        }

        .control-group input[type="range"] {
            padding: 0;
            width: 120px;
            cursor: pointer;
        }

        .range-value {
            color: #6ba3d0;
            font-size: 12px;
            min-width: 30px;
            text-align: center;
        }

        button {
            background: rgba(100, 150, 180, 0.6);
            font-weight: 600;
        }

        button:hover {
            background: rgba(100, 150, 180, 0.8);
        }

        .title {
            color: #a0c0e0;
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 1px;
            margin-right: 20px;
        }

        @media (max-width: 768px) {
            .controls {
                padding: 12px;
                gap: 8px;
            }

            .control-group {
                gap: 6px;
            }

            .control-group label {
                font-size: 12px;
            }

            .control-group select,
            .control-group button {
                padding: 6px 10px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <div class="controls">
        <span class="title">üåßÔ∏è Spring Rain</span>

        <div class="control-group">
            <label for="scenery">Scenery:</label>
            <select id="scenery">
                <option value="day">Rainy Day</option>
                <option value="dusk">Dusk Rain</option>
                <option value="dawn">Dawn Mist</option>
            </select>
        </div>

        <div class="control-group">
            <label for="rainIntensity">Rain Intensity:</label>
            <input type="range" id="rainIntensity" min="0.3" max="2" step="0.1" value="1">
            <span class="range-value" id="rainValue">1.0x</span>
        </div>

        <div class="control-group">
            <label for="carFrequency">Car Traffic:</label>
            <input type="range" id="carFrequency" min="0.1" max="1.5" step="0.1" value="0.8">
            <span class="range-value" id="carValue">0.8x</span>
        </div>

        <div class="control-group">
            <label for="bloomIntensity">Bloom Intensity:</label>
            <input type="range" id="bloomIntensity" min="0.5" max="1.5" step="0.1" value="1">
            <span class="range-value" id="bloomValue">1.0x</span>
        </div>

        <button id="toggleSound">üîä Ambient On</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight - 70;

        let settings = {
            scenery: 'day',
            rainIntensity: 1,
            carFrequency: 0.8,
            bloomIntensity: 1,
            soundEnabled: true
        };

        // Control handlers
        document.getElementById('scenery').addEventListener('change', (e) => {
            settings.scenery = e.target.value;
        });

        document.getElementById('rainIntensity').addEventListener('input', (e) => {
            settings.rainIntensity = parseFloat(e.target.value);
            document.getElementById('rainValue').textContent = e.target.value + 'x';
        });

        document.getElementById('carFrequency').addEventListener('input', (e) => {
            settings.carFrequency = parseFloat(e.target.value);
            document.getElementById('carValue').textContent = e.target.value + 'x';
        });

        document.getElementById('bloomIntensity').addEventListener('input', (e) => {
            settings.bloomIntensity = parseFloat(e.target.value);
            document.getElementById('bloomValue').textContent = e.target.value + 'x';
        });

        document.getElementById('toggleSound').addEventListener('click', (e) => {
            settings.soundEnabled = !settings.soundEnabled;
            e.target.textContent = settings.soundEnabled ? 'üîä Ambient On' : 'üîá Ambient Off';
        });

        // Window resize
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight - 70;
        });

        // Raindrop class
        class Raindrop {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.speed = 4 + Math.random() * 6;
                this.length = 15 + Math.random() * 15;
                this.opacity = 0.3 + Math.random() * 0.4;
                this.wobble = Math.random() * 0.5;
                this.waveOffset = Math.random() * Math.PI * 2;
            }

            update() {
                this.y += this.speed;
                this.waveOffset += 0.05;
                this.x += Math.sin(this.waveOffset) * this.wobble * 0.3;

                if (this.y > canvas.height) {
                    this.reset();
                }
            }

            draw(ctx, intensity) {
                const gradient = ctx.createLinearGradient(
                    this.x, this.y - this.length,
                    this.x, this.y
                );
                gradient.addColorStop(0, `rgba(200, 220, 240, 0)`);
                gradient.addColorStop(1, `rgba(200, 220, 240, ${this.opacity * intensity})`);

                ctx.strokeStyle = gradient;
                ctx.lineWidth = 1.5;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(this.x, this.y - this.length);
                ctx.lineTo(this.x, this.y);
                ctx.stroke();
            }
        }

        // Car class
        class Car {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = -80;
                this.y = canvas.height * 0.65 + Math.random() * 15;
                this.speed = 2 + Math.random() * 4;
                this.width = 60;
                this.height = 35;
                this.rotation = 0;
                this.lightIntensity = 0.3;
            }

            update() {
                this.x += this.speed;
                this.lightIntensity = 0.3 + Math.sin(Date.now() * 0.005) * 0.2;
            }

            draw(ctx, bloomIntensity) {
                const roadY = canvas.height * 0.65;
                const perspective = (this.y - roadY) / (canvas.height * 0.3);
                const scaleFactor = 0.6 + perspective * 0.4;

                ctx.save();
                ctx.globalAlpha = 0.7;

                // Car body
                ctx.fillStyle = `rgba(${40 + Math.random() * 30}, ${50 + Math.random() * 30}, ${60 + Math.random() * 40}, 0.8)`;
                ctx.fillRect(this.x, this.y, this.width, this.height);

                // Headlights glow
                const glowColor = `rgba(255, 240, 180, ${this.lightIntensity * bloomIntensity})`;
                const gradient = ctx.createRadialGradient(
                    this.x + 10, this.y + 15, 0,
                    this.x + 10, this.y + 15, 40
                );
                gradient.addColorStop(0, glowColor);
                gradient.addColorStop(1, 'rgba(255, 240, 180, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(this.x - 30, this.y, 80, this.height);

                // Reflection on wet road
                ctx.globalAlpha = 0.2;
                ctx.fillStyle = `rgba(255, 240, 180, ${this.lightIntensity * 0.5})`;
                ctx.fillRect(this.x, this.y + this.height + 5, this.width, 20);

                ctx.restore();
            }

            isOffscreen() {
                return this.x > canvas.width + 100;
            }
        }

        // Initialize raindrops
        const raindrops = [];
        const rainCount = 200;
        for (let i = 0; i < rainCount; i++) {
            raindrops.push(new Raindrop());
        }

        // Car management
        const cars = [];
        let carSpawnTimer = 0;

        // Color themes
        const themes = {
            day: {
                skyTop: '#4a5f7f',
                skyBottom: '#8a9db8',
                roadColor: '#4a5a6a',
                roadWetColor: '#5a6a7a',
                horizonColor: '#7a8fa8'
            },
            dusk: {
                skyTop: '#3a4f6f',
                skyBottom: '#7a6f8a',
                roadColor: '#5a5a5a',
                roadWetColor: '#6a7a7a',
                horizonColor: '#8a7fa8'
            },
            dawn: {
                skyTop: '#5a6f8f',
                skyBottom: '#9a8fa8',
                roadColor: '#5a6f8a',
                roadWetColor: '#6a7f9a',
                horizonColor: '#8a9fba'
            }
        };

        function drawScene() {
            const theme = themes[settings.scenery];

            // Sky gradient
            const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            skyGradient.addColorStop(0, theme.skyTop);
            skyGradient.addColorStop(0.4, theme.skyBottom);
            skyGradient.addColorStop(1, theme.horizonColor);
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Atmospheric moisture effect
            ctx.fillStyle = 'rgba(200, 210, 220, 0.08)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const roadY = canvas.height * 0.65;
            const roadHeight = canvas.height - roadY;

            // Road perspective
            ctx.fillStyle = theme.roadColor;
            ctx.fillRect(0, roadY, canvas.width, roadHeight);

            // Wet road with reflections
            const wetGradient = ctx.createLinearGradient(0, roadY, 0, roadY + roadHeight);
            wetGradient.addColorStop(0, 'rgba(120, 140, 160, 0.3)');
            wetGradient.addColorStop(0.5, 'rgba(150, 170, 190, 0.4)');
            wetGradient.addColorStop(1, 'rgba(100, 120, 140, 0.2)');
            ctx.fillStyle = wetGradient;
            ctx.fillRect(0, roadY, canvas.width, roadHeight);

            // Road markings
            ctx.strokeStyle = 'rgba(200, 200, 200, 0.15)';
            ctx.lineWidth = 2;
            ctx.setLineDash([20, 15]);
            ctx.beginPath();
            ctx.moveTo(0, roadY + roadHeight * 0.5);
            ctx.lineTo(canvas.width, roadY + roadHeight * 0.5);
            ctx.stroke();
            ctx.setLineDash([]);

            // Draw houses in background
            drawHouses();

            // Draw trees with blooming flowers
            drawTrees();

            // Draw parked cars
            drawParkedCars();

            // Draw streetlights
            drawStreetlights();

            // Rain
            raindrops.forEach(drop => {
                drop.update();
                drop.draw(ctx, settings.rainIntensity);
            });

            // Manage moving cars
            carSpawnTimer += settings.carFrequency * 0.01;
            if (carSpawnTimer > 1 && Math.random() > 0.7) {
                cars.push(new Car());
                carSpawnTimer = 0;
            }

            // Update and draw moving cars
            for (let i = cars.length - 1; i >= 0; i--) {
                cars[i].update();
                cars[i].draw(ctx, settings.bloomIntensity);
                if (cars[i].isOffscreen()) {
                    cars.splice(i, 1);
                }
            }

            // Rainy window distortion effect
            drawRainDropletsMask();

            // Vignette for calmness
            const vignetteGradient = ctx.createRadialGradient(
                canvas.width * 0.5, canvas.height * 0.5, 0,
                canvas.width * 0.5, canvas.height * 0.5, canvas.width
            );
            vignetteGradient.addColorStop(0, 'rgba(0, 0, 0, 0)');
            vignetteGradient.addColorStop(1, 'rgba(0, 0, 0, 0.15)');
            ctx.fillStyle = vignetteGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function drawHouses() {
            const roadY = canvas.height * 0.65;
            const houses = [
                { x: 50, y: roadY * 0.6, width: 120, height: 100, color: 'rgba(180, 150, 120, 0.8)' },
                { x: 250, y: roadY * 0.55, width: 140, height: 110, color: 'rgba(160, 140, 100, 0.8)' },
                { x: 500, y: roadY * 0.58, width: 130, height: 105, color: 'rgba(170, 145, 110, 0.8)' },
                { x: 750, y: roadY * 0.62, width: 125, height: 95, color: 'rgba(185, 155, 125, 0.8)' },
                { x: canvas.width - 200, y: roadY * 0.60, width: 135, height: 100, color: 'rgba(175, 150, 115, 0.8)' }
            ];

            houses.forEach(house => {
                // House body
                ctx.fillStyle = house.color;
                ctx.fillRect(house.x, house.y, house.width, house.height);

                // Roof
                ctx.fillStyle = 'rgba(80, 60, 40, 0.7)';
                ctx.beginPath();
                ctx.moveTo(house.x, house.y);
                ctx.lineTo(house.x + house.width * 0.5, house.y - 40);
                ctx.lineTo(house.x + house.width, house.y);
                ctx.fill();

                // Windows with light
                const windowColor = settings.scenery === 'day' ? 'rgba(255, 250, 200, 0.6)' : 'rgba(255, 240, 100, 0.8)';
                const windowSize = 20;
                const windowSpacing = 35;
                for (let i = 0; i < 2; i++) {
                    for (let j = 0; j < 3; j++) {
                        const wx = house.x + 20 + j * windowSpacing;
                        const wy = house.y + 25 + i * 35;
                        ctx.fillStyle = windowColor;
                        ctx.fillRect(wx, wy, windowSize, windowSize);
                        ctx.strokeStyle = 'rgba(100, 100, 100, 0.5)';
                        ctx.lineWidth = 1;
                        ctx.strokeRect(wx, wy, windowSize, windowSize);
                    }
                }

                // Door
                ctx.fillStyle = 'rgba(80, 60, 40, 0.8)';
                ctx.fillRect(house.x + house.width * 0.4, house.y + house.height * 0.7, 30, 35);
                ctx.fillStyle = 'rgba(220, 180, 80, 0.7)';
                ctx.beginPath();
                ctx.arc(house.x + house.width * 0.4 + 28, house.y + house.height * 0.85, 2, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawTrees() {
            const roadY = canvas.height * 0.65;
            const trees = [
                { x: 150, y: roadY * 0.35, size: 1.2 },
                { x: 400, y: roadY * 0.30, size: 1.4 },
                { x: 700, y: roadY * 0.38, size: 1.1 },
                { x: canvas.width - 150, y: roadY * 0.32, size: 1.3 }
            ];

            trees.forEach(tree => {
                // Trunk
                ctx.fillStyle = 'rgba(80, 60, 40, 0.7)';
                ctx.fillRect(tree.x - 15, tree.y + 80, 30, 60);

                // Foliage
                ctx.fillStyle = 'rgba(80, 120, 60, 0.6)';
                ctx.beginPath();
                ctx.arc(tree.x, tree.y + 40, 60 * tree.size, 0, Math.PI * 2);
                ctx.fill();

                // Blooming flowers (pink petals)
                const petalColor = settings.bloomIntensity > 1 ? 
                    `rgba(255, ${180 - settings.bloomIntensity * 20}, 200, ${0.5 + settings.bloomIntensity * 0.3})` :
                    `rgba(255, 180, 200, ${0.4 + settings.bloomIntensity * 0.1})`;

                for (let i = 0; i < 12; i++) {
                    const angle = (i / 12) * Math.PI * 2;
                    const px = tree.x + Math.cos(angle) * 55 * tree.size;
                    const py = tree.y + 30 + Math.sin(angle) * 55 * tree.size;
                    ctx.fillStyle = petalColor;
                    ctx.beginPath();
                    ctx.arc(px, py, 6 * tree.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
        }

        function drawParkedCars() {
            const roadY = canvas.height * 0.65;
            const parkedCars = [
                { x: 100, y: roadY + 8, color: 'rgba(100, 120, 180, 0.7)' },
                { x: 250, y: roadY + 12, color: 'rgba(160, 100, 100, 0.7)' },
                { x: 550, y: roadY + 10, color: 'rgba(100, 140, 100, 0.7)' },
                { x: 800, y: roadY + 15, color: 'rgba(180, 140, 80, 0.7)' }
            ];

            parkedCars.forEach(car => {
                ctx.fillStyle = car.color;
                ctx.fillRect(car.x, car.y, 50, 25);
                ctx.fillStyle = 'rgba(80, 100, 150, 0.6)';
                ctx.fillRect(car.x + 10, car.y - 10, 30, 12);
                ctx.fillStyle = 'rgba(150, 200, 220, 0.4)';
                ctx.fillRect(car.x + 5, car.y - 8, 12, 10);
                ctx.fillRect(car.x + 28, car.y - 8, 12, 10);
            });
        }

        function drawStreetlights() {
            const roadY = canvas.height * 0.65;
            const lights = [
                { x: 200, y: roadY * 0.35 },
                { x: 550, y: roadY * 0.33 },
                { x: canvas.width - 200, y: roadY * 0.36 }
            ];

            lights.forEach(light => {
                // Pole
                ctx.strokeStyle = 'rgba(100, 100, 100, 0.6)';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(light.x, light.y + 150);
                ctx.lineTo(light.x, light.y);
                ctx.stroke();

                // Light bulb glow
                const glowIntensity = settings.scenery === 'day' ? 0.2 : 0.5;
                const gradient = ctx.createRadialGradient(light.x, light.y, 0, light.x, light.y, 80);
                gradient.addColorStop(0, `rgba(255, 240, 180, ${0.3 * glowIntensity})`);
                gradient.addColorStop(1, 'rgba(255, 240, 180, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(light.x - 80, light.y - 80, 160, 160);

                // Bulb
                ctx.fillStyle = 'rgba(255, 240, 180, 0.8)';
                ctx.beginPath();
                ctx.arc(light.x, light.y + 10, 5, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawRainDropletsMask() {
            // Simulate rain droplets on a window pane
            const droplets = [];
            const dropletCount = 8 + Math.floor(settings.rainIntensity * 3);

            for (let i = 0; i < dropletCount; i++) {
                const size = 3 + Math.random() * 8;
                const x = Math.random() * canvas.width * 0.15 + (i % 3) * (canvas.width * 0.3);
                const y = Math.random() * canvas.height * 0.4 + (Math.floor(i / 3) * (canvas.height * 0.2));

                ctx.fillStyle = `rgba(200, 220, 240, ${0.15 + Math.random() * 0.1})`;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();

                // Droplet streak
                ctx.strokeStyle = `rgba(200, 220, 240, ${0.1 + Math.random() * 0.08})`;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(x, y + size);
                ctx.lineTo(x + (Math.random() - 0.5) * 10, y + size + 20 + Math.random() * 20);
                ctx.stroke();
            }
        }

        function animate() {
            drawScene();
            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
